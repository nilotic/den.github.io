---
layout: post
title:  "Metal 2 on A11 — Imageblock Sample Coverage Control"
subtitle: "WWDC 2018"
date:   2018-10-02 00:39:19 -0000
background: '/img/posts/wwdc18.png'
---




<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Metal 2 on A11 — Imageblock Sample Coverage Control</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Metal 2 on A11 — Imageblock Sample Coverage Control</h1>
</header>
<section data-field="subtitle" class="p-summary">
Tech Talks
</section>
<section data-field="body" class="e-content">
<section name="6f95" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="b80e" id="b80e" class="graf graf--h3 graf--leading graf--title">TechMetal 2 on A11 — Imageblock Sample Coverage Control</h3><h4 name="a54d" id="a54d" class="graf graf--h4 graf-after--h3 graf--subtitle"><a href="https://developer.apple.com/videos/play/tech-talks/606/" data-href="https://developer.apple.com/videos/play/tech-talks/606/" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">Tech Talks</a></h4><h3 name="5288" id="5288" class="graf graf--h3 graf-after--h4">Multisampling Antialiasing</h3><figure name="59c2" id="59c2" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 339px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 48.4%;"></div><img class="graf-image" data-image-id="1*KDukatsE2MUsp_ZQa8QpmA.png" data-width="2716" data-height="1314" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*KDukatsE2MUsp_ZQa8QpmA.png"></div></figure><h3 name="4b4b" id="4b4b" class="graf graf--h3 graf-after--figure">MSAA on A-Series GPUs</h3><ul class="postList"><li name="9838" id="9838" class="graf graf--li graf-after--h3">Edge tracking built into hardware for fast blending</li><li name="b6dc" id="b6dc" class="graf graf--li graf-after--li">Efficient memory usage with Memoryless Render Targets</li><li name="0ed7" id="0ed7" class="graf graf--li graf-after--li">Optimize memory bandwidth with resolve store action</li><li name="ec7f" id="ec7f" class="graf graf--li graf-after--li">Programmable Sample Positions introduced in Metal 2</li></ul><h3 name="da9d" id="da9d" class="graf graf--h3 graf-after--li">Enhanced MSAA on A11</h3><ul class="postList"><li name="477b" id="477b" class="graf graf--li graf-after--h3">Faster MSAA hardware<br>- A11 GPU tracks unique sample data for even faster blending</li><li name="244e" id="244e" class="graf graf--li graf-after--li">Imageblock Sample Coverage Control<br>- Access sample coverage tracking data<br>- Resolve at any time in your render pass<br>- Implement custom resolve with tile shading</li></ul><h3 name="161c" id="161c" class="graf graf--h3 graf-after--li">Edge Tracking</h3><ul class="postList"><li name="1b2f" id="1b2f" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">A-series GPUs track primitive edges<br>- </strong>Pixels without edges blend per pixel<br>- Pixels that contain edges blend each sample</li><li name="e47a" id="e47a" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">A11 GPU also tracks unique samples</strong><br>- Pixels that contain edges blend unique samples</li></ul><figure name="3ff2" id="3ff2" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 699px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 99.8%;"></div><img class="graf-image" data-image-id="1*1hBb-PkMbex_0bTdhA-lFg.png" data-width="1023" data-height="1021" src="https://cdn-images-1.medium.com/max/800/1*1hBb-PkMbex_0bTdhA-lFg.png"></div></figure><h3 name="04fc" id="04fc" class="graf graf--h3 graf-after--figure">Enhanced MSAA on A11</h3><p name="ff5b" id="ff5b" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Optimized multisampled blending</strong></p><ul class="postList"><li name="a70f" id="a70f" class="graf graf--li graf-after--p">GPU tracks unique colors per pixel</li><li name="8a1e" id="8a1e" class="graf graf--li graf-after--li">Primitives can add or merge colors</li><li name="3028" id="3028" class="graf graf--li graf-after--li">Only blend unique values<br>- Includes programmable blending</li></ul><figure name="e233" id="e233" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 607px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 86.7%;"></div><img class="graf-image" data-image-id="1*yGwtmL4xU6wob8GopYBQMQ.png" data-width="1325" data-height="1149" src="https://cdn-images-1.medium.com/max/800/1*yGwtmL4xU6wob8GopYBQMQ.png"></div></figure><h3 name="1aa9" id="1aa9" class="graf graf--h3 graf-after--figure">Color Tracking Example</h3><ul class="postList"><li name="755b" id="755b" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Initial Value<br>- </strong>All samples are initialized to a clear color<br>- 1 color represents all 4 samples</li><li name="2724" id="2724" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">New unique color introduced<br></strong>- Primitive edge can introduce a new color<br>- Covered samples are reassigned to the new color</li><li name="adca" id="adca" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Blend each unique color<br></strong>- Blend for each covered color<br>- New unique colors created as needed</li><li name="7032" id="7032" class="graf graf--li graf-after--li">Merging colors<br>- Color count can grow and shrink<br>- Opaque geometry can merge colors</li></ul><figure name="717a" id="717a" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 613px; max-height: 487px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 79.4%;"></div><img class="graf-image" data-image-id="1*EY_e_i4Y7BvGVHbPVSyN3A.gif" data-width="613" data-height="487" src="https://cdn-images-1.medium.com/max/800/1*EY_e_i4Y7BvGVHbPVSyN3A.gif"></div></figure><h3 name="5c05" id="5c05" class="graf graf--h3 graf-after--figure">Imageblock Sample Coverage Control</h3><ul class="postList"><li name="f4c5" id="f4c5" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Implement new algorithms and optimizations</strong></li></ul><figure name="e877" id="e877" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 238px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 34%;"></div><img class="graf-image" data-image-id="1*beOdqQwyK4jz0NV_NFIcow.png" data-width="2819" data-height="958" src="https://cdn-images-1.medium.com/max/800/1*beOdqQwyK4jz0NV_NFIcow.png"></div><figcaption class="imageCaption">Custom resolve with tile shading</figcaption></figure><ul class="postList"><li name="d041" id="d041" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Resolve in the middle of a render pass<br></strong>- Resolve sampels before blending<br>- Ensure only 1 unique color to blend per pixel</li></ul><figure name="2e1b" id="2e1b" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 223px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 31.8%;"></div><img class="graf-image" data-image-id="1*wvRzenNbzWRaQBn_vsF_7w.png" data-width="2407" data-height="766" src="https://cdn-images-1.medium.com/max/800/1*wvRzenNbzWRaQBn_vsF_7w.png"></div></figure><h3 name="a5cd" id="a5cd" class="graf graf--h3 graf-after--figure">Sample Code — Surface Aggregation</h3><ul class="postList"><li name="9c1e" id="9c1e" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Merge surfaces heuristically</strong></li></ul><figure name="33f8" id="33f8" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 315px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45%;"></div><img class="graf-image" data-image-id="1*YJntTN0LqB_63rrBgjL_yw.png" data-width="2750" data-height="1238" src="https://cdn-images-1.medium.com/max/800/1*YJntTN0LqB_63rrBgjL_yw.png"></div></figure><ul class="postList"><li name="2ea2" id="2ea2" class="graf graf--li graf-after--figure"><strong class="markup--strong markup--li-strong">Do more in a single render pass<br></strong>- Render G-buffer with MSAA<br>- Reduce unique G-buffer samples with tile pipeline<br>- Light and shade aggregate G-buffer samples</li></ul><figure name="8200" id="8200" class="graf graf--figure graf-after--li graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 246px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.199999999999996%;"></div><img class="graf-image" data-image-id="1*7-YpoGzOveP5EJ3xibGX0g.png" data-width="2229" data-height="784" src="https://cdn-images-1.medium.com/max/800/1*7-YpoGzOveP5EJ3xibGX0g.png"></div></figure></div></div></section>
</section>