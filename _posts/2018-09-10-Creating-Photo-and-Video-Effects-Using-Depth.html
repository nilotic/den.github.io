---
layout: post
title:  "Creating Photo and Video Effects Using Depth"
subtitle: "WWDC 2018"
date:   2018-09-10 20:23:33 -0000
background: '/img/posts/wwdc18.png'
---





<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Creating Photo and Video Effects Using Depth</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Creating Photo and Video Effects Using Depth</h1>
</header>
<section data-field="subtitle" class="p-summary">
WWDC 2018
</section>
<section data-field="body" class="e-content">
<section name="7ea3" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="807c" id="807c" class="graf graf--h3 graf--leading graf--title">Creating Photo and Video Effects Using Depth</h3><h4 name="decf" id="decf" class="graf graf--h4 graf-after--h3 graf--subtitle"><a href="https://developer.apple.com/videos/play/wwdc2018/503/" data-href="https://developer.apple.com/videos/play/wwdc2018/503/" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">WWDC 2018</a></h4><figure name="3d82" id="3d82" class="graf graf--figure graf-after--h4"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 370px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 52.800000000000004%;"></div><img class="graf-image" data-image-id="1*6ow27jyBdNVLyg-M0o5YTg.jpeg" data-width="1170" data-height="618" src="https://cdn-images-1.medium.com/max/800/1*6ow27jyBdNVLyg-M0o5YTg.jpeg"></div></figure><h3 name="b79c" id="b79c" class="graf graf--h3 graf-after--figure">Portrait Matte</h3><ul class="postList"><li name="eb54" id="eb54" class="graf graf--li graf-after--h3">iOS 12</li><li name="e392" id="e392" class="graf graf--li graf-after--li">Front and rear</li><li name="277f" id="277f" class="graf graf--li graf-after--li">Portrait</li><li name="26e0" id="26e0" class="graf graf--li graf-after--li">People</li><li name="1139" id="1139" class="graf graf--li graf-after--li">Linear</li><li name="2e78" id="2e78" class="graf graf--li graf-after--li">No guarantee</li></ul><figure name="8ad3" id="8ad3" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 304px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 43.4%;"></div><img class="graf-image" data-image-id="1*kMwBTSfDyiKdBO_rkrzpAA.png" data-width="4644" data-height="2014" src="https://cdn-images-1.medium.com/max/800/1*kMwBTSfDyiKdBO_rkrzpAA.png"></div></figure><figure name="bbbc" id="bbbc" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 709px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 101.29999999999998%;"></div><img class="graf-image" data-image-id="1*VklDG6ntzBs8TUKOD3gsZg.png" data-width="2500" data-height="2532" src="https://cdn-images-1.medium.com/max/800/1*VklDG6ntzBs8TUKOD3gsZg.png"></div></figure><h3 name="2e8c" id="2e8c" class="graf graf--h3 graf-after--figure">Loading</h3><h4 name="ce04" id="ce04" class="graf graf--h4 graf-after--h3">ImageIO</h4><figure name="791b" id="791b" class="graf graf--figure graf-after--h4 graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 253px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 36.199999999999996%;"></div><img class="graf-image" data-image-id="1*RJuoirGNvfEb24PYfmSKqQ.png" data-width="4624" data-height="1674" src="https://cdn-images-1.medium.com/max/800/1*RJuoirGNvfEb24PYfmSKqQ.png"></div></figure></div></div></section><section name="5622" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="484c" id="484c" class="graf graf--h4 graf--leading">AVPortraitEffectsMatte</h4><figure name="2ee0" id="2ee0" class="graf graf--figure graf-after--h4"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 149px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 21.3%;"></div><img class="graf-image" data-image-id="1*xLtbl0nkKwWnxJayvnaT6g.png" data-width="4618" data-height="984" src="https://cdn-images-1.medium.com/max/800/1*xLtbl0nkKwWnxJayvnaT6g.png"></div></figure><h3 name="5556" id="5556" class="graf graf--h3 graf-after--figure">Capture</h3><p name="1ae3" id="1ae3" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">AVCapturePhoto</strong></p><figure name="6111" id="6111" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 466px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 66.60000000000001%;"></div><img class="graf-image" data-image-id="1*ajtsLGtg6asThV1NE9xlEA.png" data-width="3627" data-height="2415" src="https://cdn-images-1.medium.com/max/800/1*ajtsLGtg6asThV1NE9xlEA.png"></div></figure><h3 name="f4ab" id="f4ab" class="graf graf--h3 graf-after--figure">Loading and Saving</h3><figure name="dcee" id="dcee" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 167px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 23.799999999999997%;"></div><img class="graf-image" data-image-id="1*v3l7SynhHjMTXYxOGeoTFQ.png" data-width="4617" data-height="1100" src="https://cdn-images-1.medium.com/max/800/1*v3l7SynhHjMTXYxOGeoTFQ.png"></div></figure><figure name="ab78" id="ab78" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 385px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 54.900000000000006%;"></div><img class="graf-image" data-image-id="1*SxZ_1vK6vTKaxPjcLmBHew.png" data-width="4612" data-height="2534" src="https://cdn-images-1.medium.com/max/800/1*SxZ_1vK6vTKaxPjcLmBHew.png"></div></figure><h3 name="5c66" id="5c66" class="graf graf--h3 graf-after--figure">Sample</h3><ul class="postList"><li name="5559" id="5559" class="graf graf--li graf-after--h3"><a href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/capturing_photos_with_depth" data-href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/capturing_photos_with_depth" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">Capturing Photos with Depth</em></strong></a></li><li name="1dd5" id="1dd5" class="graf graf--li graf-after--li"><a href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/enhancing_live_video_by_leveraging_truedepth_camera_data" data-href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/enhancing_live_video_by_leveraging_truedepth_camera_data" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">Enhancing Live Video by Leveraging TrueDepth Camera Data</em></strong></a></li><li name="d246" id="d246" class="graf graf--li graf-after--li"><a href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/streaming_depth_data_from_the_truedepth_camera" data-href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/streaming_depth_data_from_the_truedepth_camera" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">Streaming Depth Data from the TrueDepth Camera</em></strong></a></li></ul><h3 name="632a" id="632a" class="graf graf--h3 graf-after--li">Demo 1</h3><p name="cd2d" id="cd2d" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Working with Depth</strong></p><figure name="a92b" id="a92b" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 4291px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 613%;"></div><img class="graf-image" data-image-id="1*xUq-k35K2hasvE8SAbFbeg.jpeg" data-width="1280" data-height="7847" src="https://cdn-images-1.medium.com/max/800/1*xUq-k35K2hasvE8SAbFbeg.jpeg"></div></figure><h3 name="ea8a" id="ea8a" class="graf graf--h3 graf-after--figure">Demo 2</h3><p name="b421" id="b421" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Working with the Portrait Effects Matte</strong></p><figure name="1c1b" id="1c1b" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 5586px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 798%;"></div><img class="graf-image" data-image-id="1*CG4t06Sd7kpeuoAk62HccA.jpeg" data-width="1280" data-height="10214" src="https://cdn-images-1.medium.com/max/800/1*CG4t06Sd7kpeuoAk62HccA.jpeg"></div></figure><h3 name="b67f" id="b67f" class="graf graf--h3 graf-after--figure">Real-Time Video Effects with TrueDepth</h3><ul class="postList"><li name="9edd" id="9edd" class="graf graf--li graf-after--h3">TrueDepth stream</li><li name="8fd1" id="8fd1" class="graf graf--li graf-after--li">Point clouds</li><li name="b430" id="b430" class="graf graf--li graf-after--li">Backdrop</li></ul><figure name="34f1" id="34f1" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 334px; max-height: 664px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 198.8%;"></div><img class="graf-image" data-image-id="1*86WMiy2GVcT9k3ZbfUIoEg.gif" data-width="334" data-height="664" src="https://cdn-images-1.medium.com/max/800/1*86WMiy2GVcT9k3ZbfUIoEg.gif"></div></figure><h3 name="0234" id="0234" class="graf graf--h3 graf-after--figure">Depth Map</h3><figure name="df2f" id="df2f" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 292px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 41.8%;"></div><img class="graf-image" data-image-id="1*Nbxcw5bLgV5VOYVZJtsGXA.png" data-width="4104" data-height="1714" src="https://cdn-images-1.medium.com/max/800/1*Nbxcw5bLgV5VOYVZJtsGXA.png"></div></figure><figure name="a3f4" id="a3f4" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 517px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 73.8%;"></div><img class="graf-image" data-image-id="1*2UTvWFyUxo4abCLsJOJZAg.gif" data-width="975" data-height="720" src="https://cdn-images-1.medium.com/max/800/1*2UTvWFyUxo4abCLsJOJZAg.gif"></div></figure><figure name="b422" id="b422" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 525px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 75%;"></div><img class="graf-image" data-image-id="1*skkK7U8qZFhSOe3fLIhPPA.gif" data-width="960" data-height="720" src="https://cdn-images-1.medium.com/max/800/1*skkK7U8qZFhSOe3fLIhPPA.gif"></div></figure><h3 name="8860" id="8860" class="graf graf--h3 graf-after--figure">How do you add a TrueDepth stream?</h3><figure name="50b5" id="50b5" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 342px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 48.9%;"></div><img class="graf-image" data-image-id="1*Fbq1rniX_jz8rw36yeSnTQ.png" data-width="3868" data-height="1890" src="https://cdn-images-1.medium.com/max/800/1*Fbq1rniX_jz8rw36yeSnTQ.png"></div></figure><h3 name="37c5" id="37c5" class="graf graf--h3 graf-after--figure">Disparity or Depth?</h3><ul class="postList"><li name="7fea" id="7fea" class="graf graf--li graf-after--h3">Disparity usually yields better results</li><li name="eca3" id="eca3" class="graf graf--li graf-after--li">Depth values are intuitive, but the error goes with Z²</li></ul><figure name="d347" id="d347" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 31px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 4.5%;"></div><img class="graf-image" data-image-id="1*SH7hgk2sKVRAuUON-09WRQ.png" data-width="3820" data-height="170" src="https://cdn-images-1.medium.com/max/800/1*SH7hgk2sKVRAuUON-09WRQ.png"></div></figure><h3 name="e15c" id="e15c" class="graf graf--h3 graf-after--figure">Resolution</h3><figure name="a43d" id="a43d" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 218px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 31.2%;"></div><img class="graf-image" data-image-id="1*ie7T4KSvD-db9fHPiY2B5g.png" data-width="4522" data-height="1410" src="https://cdn-images-1.medium.com/max/800/1*ie7T4KSvD-db9fHPiY2B5g.png"></div></figure><h3 name="c78c" id="c78c" class="graf graf--h3 graf-after--figure">Test System Pressure</h3><p name="2773" id="2773" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">High resolution + fast frame rate + processing + duration</strong></p><ul class="postList"><li name="6c83" id="6c83" class="graf graf--li graf-after--p"><code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">AVCaptureDevice.SystemPressureState.Level</strong></code></li><li name="db09" id="db09" class="graf graf--li graf-after--li">Nominal</li><li name="f119" id="f119" class="graf graf--li graf-after--li">Fair</li><li name="5982" id="5982" class="graf graf--li graf-after--li">Serious</li><li name="ccda" id="ccda" class="graf graf--li graf-after--li">Critical</li><li name="fbfa" id="fbfa" class="graf graf--li graf-after--li">Shutdown</li></ul><h3 name="49b2" id="49b2" class="graf graf--h3 graf-after--li">Monitor System Pressure and Adapt</h3><p name="64db" id="64db" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Prevent AVCaptureDevice shutdown</strong></p><ul class="postList"><li name="e067" id="e067" class="graf graf--li graf-after--p">Reduce frame rate when level is increasing:<br>- Nominal (30fps) → Serious (15 fps)<br>- Nominal (30fps) → Fair (24 fps) → Serious (20 fps) → Critical (15 fps)</li></ul><figure name="2629" id="2629" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 84px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 12%;"></div><img class="graf-image" data-image-id="1*NpGVJTO1zflK2jCmoGO6Dg.png" data-width="3370" data-height="406" src="https://cdn-images-1.medium.com/max/800/1*NpGVJTO1zflK2jCmoGO6Dg.png"></div></figure><h3 name="817c" id="817c" class="graf graf--h3 graf-after--figure">Filtered Depth Map</h3><ul class="postList"><li name="96a9" id="96a9" class="graf graf--li graf-after--h3">Smoothed, spatially and temporally</li><li name="e75a" id="e75a" class="graf graf--li graf-after--li">Holes filled, using RGB</li><li name="04bd" id="04bd" class="graf graf--li graf-after--li">For photography/ segmentation applications</li><li name="0287" id="0287" class="graf graf--li graf-after--li">iOS 12: spatial resolution of filtering improved from iOS 11</li></ul><figure name="3ec3" id="3ec3" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 53px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 7.5%;"></div><img class="graf-image" data-image-id="1*HvVK-Z2z6rmkR-TYBwVe1Q.png" data-width="2550" data-height="192" src="https://cdn-images-1.medium.com/max/800/1*HvVK-Z2z6rmkR-TYBwVe1Q.png"></div></figure><figure name="ad54" id="ad54" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 647px; max-height: 707px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 109.3%;"></div><img class="graf-image" data-image-id="1*nGrjUp3_I3fr8ha_PoHlEA.gif" data-width="647" data-height="707" src="https://cdn-images-1.medium.com/max/800/1*nGrjUp3_I3fr8ha_PoHlEA.gif"></div></figure><h3 name="7d77" id="7d77" class="graf graf--h3 graf-after--figure">Using Raw Depth Data</h3><ul class="postList"><li name="4849" id="4849" class="graf graf--li graf-after--h3">Use for point clouds, or real world measurements</li><li name="4da7" id="4da7" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">No depth value == 0</em> ⚠️</strong></li><li name="fbb0" id="fbb0" class="graf graf--li graf-after--li">Watch out for averaging / downsampling</li></ul><h3 name="2ea9" id="2ea9" class="graf graf--h3 graf-after--li">Depth Map Holes ⚠️</h3><ul class="postList"><li name="7f28" id="7f28" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">The TrueDepth camera detects most objects up to about 5 meters</strong></li><li name="f255" id="f255" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">Low reflectivity materials absorb light</em></strong></li><li name="7d63" id="7d63" class="graf graf--li graf-after--li">Reflectivity</li><li name="13db" id="13db" class="graf graf--li graf-after--li">Specular materials reflect light only from certain directions</li></ul><figure name="6fb8" id="6fb8" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 332px; max-height: 662px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 199.4%;"></div><img class="graf-image" data-image-id="1*L06UV7xPjKN6igaU-jjRXA.gif" data-width="332" data-height="662" src="https://cdn-images-1.medium.com/max/800/1*L06UV7xPjKN6igaU-jjRXA.gif"></div></figure><ul class="postList"><li name="5fd0" id="5fd0" class="graf graf--li graf-after--figure">Outdoor conditions are more challenging</li></ul><figure name="53f5" id="53f5" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 328px; max-height: 661px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 201.5%;"></div><img class="graf-image" data-image-id="1*hxSVTznZx8i_1K_TiCUpdw.gif" data-width="328" data-height="661" src="https://cdn-images-1.medium.com/max/800/1*hxSVTznZx8i_1K_TiCUpdw.gif"></div></figure><ul class="postList"><li name="57d5" id="57d5" class="graf graf--li graf-after--figure">Shadow from parallax between projector and camera</li></ul><figure name="27b5" id="27b5" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 624px; max-height: 701px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 112.3%;"></div><img class="graf-image" data-image-id="1*e05aCCzbzwYRHowfUgQOow.gif" data-width="624" data-height="701" src="https://cdn-images-1.medium.com/max/800/1*e05aCCzbzwYRHowfUgQOow.gif"></div></figure><h3 name="a7c4" id="a7c4" class="graf graf--h3 graf-after--figure">Point clouds</h3><figure name="c767" id="c767" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 324px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 46.300000000000004%;"></div><img class="graf-image" data-image-id="1*yz3Ujil6xmzYJmpe8KNItQ.png" data-width="4248" data-height="1968" src="https://cdn-images-1.medium.com/max/800/1*yz3Ujil6xmzYJmpe8KNItQ.png"></div><figcaption class="imageCaption"><strong class="markup--strong markup--figure-strong">From Depth Map to Point Cloud</strong></figcaption></figure><figure name="642f" id="642f" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 394px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="1*LGkbWgF2GyT8U8hWy1OeVw.gif" data-width="1280" data-height="720" src="https://cdn-images-1.medium.com/max/800/1*LGkbWgF2GyT8U8hWy1OeVw.gif"></div></figure><h3 name="6828" id="6828" class="graf graf--h3 graf-after--figure">RGB-D</h3><figure name="531d" id="531d" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 325px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 46.5%;"></div><img class="graf-image" data-image-id="1*S2pDQriAqkrocD19cWGcfQ.gif" data-width="1280" data-height="595" src="https://cdn-images-1.medium.com/max/800/1*S2pDQriAqkrocD19cWGcfQ.gif"></div></figure><h3 name="eb5d" id="eb5d" class="graf graf--h3 graf-after--figure">Vertex Shader</h3><p name="8c69" id="8c69" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Point location</strong></p><ul class="postList"><li name="b8f6" id="b8f6" class="graf graf--li graf-after--p">Z = func( U, V )</li><li name="9f12" id="9f12" class="graf graf--li graf-after--li">Tranform to ( X, Y, Z )</li><li name="4507" id="4507" class="graf graf--li graf-after--li">Reproject with view matrix</li></ul><figure name="0a69" id="0a69" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 460px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 65.7%;"></div><img class="graf-image" data-image-id="1*49XpXHUh-rb5qd_et_Ja0Q.gif" data-width="816" data-height="536" src="https://cdn-images-1.medium.com/max/800/1*49XpXHUh-rb5qd_et_Ja0Q.gif"></div></figure><h3 name="9f83" id="9f83" class="graf graf--h3 graf-after--figure">Fragment Shader</h3><p name="c493" id="c493" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Point color</strong></p><ul class="postList"><li name="b65e" id="b65e" class="graf graf--li graf-after--p">Get vertex info</li><li name="b05b" id="b05b" class="graf graf--li graf-after--li">Discard holes ( Z == 0 )</li><li name="abe2" id="abe2" class="graf graf--li graf-after--li">Apply color from RGB frame at vertex coordinates</li></ul><figure name="df6f" id="df6f" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 621px; max-height: 575px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 92.60000000000001%;"></div><img class="graf-image" data-image-id="1*9x_m6rvys97dTT2vwgZUGw.gif" data-width="621" data-height="575" src="https://cdn-images-1.medium.com/max/800/1*9x_m6rvys97dTT2vwgZUGw.gif"></div></figure><h3 name="d98a" id="d98a" class="graf graf--h3 graf-after--figure">Backdrop</h3><figure name="d2b6" id="d2b6" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 313px; max-height: 675px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 215.7%;"></div><img class="graf-image" data-image-id="1*lcBMlh2K37JGsWx0tT-HMA.gif" data-width="313" data-height="675" src="https://cdn-images-1.medium.com/max/800/1*lcBMlh2K37JGsWx0tT-HMA.gif"></div></figure><h3 name="aba7" id="aba7" class="graf graf--h3 graf-after--figure">Per-Frame, Real-Time Processing</h3><ul class="postList"><li name="db85" id="db85" class="graf graf--li graf-after--h3">Detect a face</li><li name="be36" id="be36" class="graf graf--li graf-after--li">Create binary foreground mask, smooth, and upscale</li><li name="d6a4" id="d6a4" class="graf graf--li graf-after--li">Upscale foreground to background and blend</li><li name="100f" id="100f" class="graf graf--li graf-after--li">Resize background to video resolution once:<br>- Not upscaling foreground<br>- Blending at lower resolution</li></ul><h3 name="2239" id="2239" class="graf graf--h3 graf-after--li">Getting Face Metadata</h3><ul class="postList"><li name="ba51" id="ba51" class="graf graf--li graf-after--h3">Until a face is detected, use default face depth of 0.5 meters</li><li name="1464" id="1464" class="graf graf--li graf-after--li">Transform center of face to depth map coordinates, and get its depth</li></ul><figure name="e7c6" id="e7c6" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 39px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 5.5%;"></div><img class="graf-image" data-image-id="1*dkc3mczabUc8lVz97BB-0w.png" data-width="3632" data-height="200" src="https://cdn-images-1.medium.com/max/800/1*dkc3mczabUc8lVz97BB-0w.png"></div></figure><h3 name="eb04" id="eb04" class="graf graf--h3 graf-after--figure">Binary Foreground Mask</h3><ul class="postList"><li name="ecc2" id="ecc2" class="graf graf--li graf-after--h3">Threshold = face depth + 0.25 meters</li><li name="f0a1" id="f0a1" class="graf graf--li graf-after--li">Binary mask:<br>- Foreground = 1<br>- Background = 0</li></ul><figure name="2a3a" id="2a3a" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 332px; max-height: 660px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 198.8%;"></div><img class="graf-image" data-image-id="1*v4JQGmplp3Nsm-WicDgSAw.gif" data-width="332" data-height="660" src="https://cdn-images-1.medium.com/max/800/1*v4JQGmplp3Nsm-WicDgSAw.gif"></div></figure><h3 name="eea7" id="eea7" class="graf graf--h3 graf-after--figure">Gaussian Blur</h3><figure name="9ae1" id="9ae1" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 260px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 37.2%;"></div><img class="graf-image" data-image-id="1*rRA91lSdGTWCo48MDx08Rw.png" data-width="4002" data-height="1488" src="https://cdn-images-1.medium.com/max/800/1*rRA91lSdGTWCo48MDx08Rw.png"></div></figure><figure name="3a73" id="3a73" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 329px; max-height: 661px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 200.89999999999998%;"></div><img class="graf-image" data-image-id="1*uYvKPBeQG29UrptPn0aoBA.gif" data-width="329" data-height="661" src="https://cdn-images-1.medium.com/max/800/1*uYvKPBeQG29UrptPn0aoBA.gif"></div></figure><h3 name="a3a9" id="a3a9" class="graf graf--h3 graf-after--figure">Gamma Adjust</h3><figure name="b93d" id="b93d" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 332px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 47.5%;"></div><img class="graf-image" data-image-id="1*v88G9rxc-a4QAYe_2XDA7A.png" data-width="4730" data-height="2246" src="https://cdn-images-1.medium.com/max/800/1*v88G9rxc-a4QAYe_2XDA7A.png"></div></figure><figure name="6e61" id="6e61" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 332px; max-height: 660px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 198.8%;"></div><img class="graf-image" data-image-id="1*lQSZc12sp9h8vUH0ElCkbA.gif" data-width="332" data-height="660" src="https://cdn-images-1.medium.com/max/800/1*lQSZc12sp9h8vUH0ElCkbA.gif"></div></figure><h3 name="51a8" id="51a8" class="graf graf--h3 graf-after--figure">Binary Mask</h3><p name="792b" id="792b" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Alpha matte</strong></p><figure name="a672" id="a672" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 307px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 43.9%;"></div><img class="graf-image" data-image-id="1*hecMwIF_4g8pEeQDQmaSBQ.png" data-width="4624" data-height="2029" src="https://cdn-images-1.medium.com/max/800/1*hecMwIF_4g8pEeQDQmaSBQ.png"></div></figure><h3 name="21d3" id="21d3" class="graf graf--h3 graf-after--figure">Clamp Before Filtering</h3><p name="9f64" id="9f64" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Avoiding edge softening</strong></p><figure name="a552" id="a552" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 89px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 12.8%;"></div><img class="graf-image" data-image-id="1*6Ti15mK-QVr-IZu4VuLl6w.png" data-width="4404" data-height="562" src="https://cdn-images-1.medium.com/max/800/1*6Ti15mK-QVr-IZu4VuLl6w.png"></div></figure><h3 name="5b7d" id="5b7d" class="graf graf--h3 graf-after--figure">Blending Foreground with Background</h3><figure name="1835" id="1835" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 320px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45.7%;"></div><img class="graf-image" data-image-id="1*sI-Cip_a8ydh12VEXYH3aQ.png" data-width="4186" data-height="1914" src="https://cdn-images-1.medium.com/max/800/1*sI-Cip_a8ydh12VEXYH3aQ.png"></div></figure><h3 name="12ec" id="12ec" class="graf graf--h3 graf-after--figure">TrueDepth Stream</h3><p name="c98c" id="c98c" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">640 x 480 depth map registered to video at 30 fps</strong></p><figure name="b420" id="b420" class="graf graf--figure graf-after--p graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 267px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 38.2%;"></div><img class="graf-image" data-image-id="1*Gk2Mj9ZBt2FAef99s9e1VQ.png" data-width="4266" data-height="1628" src="https://cdn-images-1.medium.com/max/800/1*Gk2Mj9ZBt2FAef99s9e1VQ.png"></div></figure></div></div></section>
</section>