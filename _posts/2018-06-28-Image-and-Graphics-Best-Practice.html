---
layout: post
title:  "Image and Graphics Best Practice"
subtitle: "WWDC 2018"
date:   2018-06-28 04:45:13 -0000
background: '/img/posts/wwdc18.png'
---





<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Image and Graphics Best Practice</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Image and Graphics Best Practice</h1>
</header>
<section data-field="subtitle" class="p-summary">
WWDC 2018
</section>
<section data-field="body" class="e-content">
<section name="73e9" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="5915" id="5915" class="graf graf--h3 graf--leading graf--title">Image and Graphics Best¬†Practice</h3><h4 name="af1f" id="af1f" class="graf graf--h4 graf-after--h3 graf--subtitle"><a href="https://developer.apple.com/videos/play/wwdc2018/219/" data-href="https://developer.apple.com/videos/play/wwdc2018/219/" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">WWDC 2018</a></h4><h3 name="40a5" id="40a5" class="graf graf--h3 graf-after--h4">Image Render¬†Pipeline</h3><figure name="ead6" id="ead6" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 196px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 28.000000000000004%;"></div><img class="graf-image" data-image-id="1*Ftqgg4mJ7WBSUs2cGBruvA.png" data-width="1264" data-height="354" src="https://cdn-images-1.medium.com/max/800/1*Ftqgg4mJ7WBSUs2cGBruvA.png"></div></figure><h3 name="fc85" id="fc85" class="graf graf--h3 graf-after--figure">Image Buffers</h3><figure name="c475" id="c475" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 349px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 49.9%;"></div><img class="graf-image" data-image-id="1*5ayVx86aqd76Jy5EBGVq2Q.gif" data-width="1074" data-height="536" src="https://cdn-images-1.medium.com/max/800/1*5ayVx86aqd76Jy5EBGVq2Q.gif"></div><figcaption class="imageCaption">Frame Buffer</figcaption></figure><p name="d033" id="d033" class="graf graf--p graf-after--figure">If you use the <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">same</em> image</strong>, the renderer will <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">reuse</em> the frame buffer.</strong></p><figure name="a87f" id="a87f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 355px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 50.7%;"></div><img class="graf-image" data-image-id="1*btjEb8HLBfHY7BvVjkWl8g.gif" data-width="1058" data-height="536" src="https://cdn-images-1.medium.com/max/800/1*btjEb8HLBfHY7BvVjkWl8g.gif"></div><figcaption class="imageCaption">Reuse the frame¬†buffer</figcaption></figure><h3 name="1f64" id="1f64" class="graf graf--h3 graf-after--figure">Pipeline in¬†Action</h3><figure name="9529" id="9529" class="graf graf--figure graf-after--h3 graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 490px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 70%;"></div><img class="graf-image" data-image-id="1*4ojdWenfNc9Ulj5TXAB1IA.gif" data-width="740" data-height="518" src="https://cdn-images-1.medium.com/max/800/1*4ojdWenfNc9Ulj5TXAB1IA.gif"></div></figure></div></div></section><section name="e0f6" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><figure name="7d19" id="7d19" class="graf graf--figure graf--leading"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 443px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 63.2%;"></div><img class="graf-image" data-image-id="1*XAQb-QXi4xI_0hSHK_FE6w.png" data-width="1768" data-height="1118" src="https://cdn-images-1.medium.com/max/800/1*XAQb-QXi4xI_0hSHK_FE6w.png"></div></figure><h3 name="eb0b" id="eb0b" class="graf graf--h3 graf-after--figure">Downsampling (Solution) üëç</h3><figure name="6bd2" id="6bd2" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 222px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 31.7%;"></div><img class="graf-image" data-image-id="1*JQEyXTieY_LRKHUfCVayYQ.gif" data-width="1066" data-height="338" src="https://cdn-images-1.medium.com/max/800/1*JQEyXTieY_LRKHUfCVayYQ.gif"></div><figcaption class="imageCaption">Downsampling process</figcaption></figure><figure name="39de" id="39de" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 331px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 47.199999999999996%;"></div><img class="graf-image" data-image-id="1*730ogaLNUXGzsewwAl3aKw.png" data-width="2092" data-height="988" src="https://cdn-images-1.medium.com/max/800/1*730ogaLNUXGzsewwAl3aKw.png"></div><figcaption class="imageCaption">Downsampling large images for display at smaller¬†size</figcaption></figure><figure name="7d64" id="7d64" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 619px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 88.4%;"></div><img class="graf-image" data-image-id="1*XhQVscIRss2r9fCJt2rvSg.png" data-width="1550" data-height="1370" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*XhQVscIRss2r9fCJt2rvSg.png"></div></figure><h3 name="51ac" id="51ac" class="graf graf--h3 graf-after--figure">Decoding in Scrollable Views</h3><p name="b257" id="b257" class="graf graf--p graf-after--h3">Use the <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">prefetching</em></strong>, <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">background decoding </em></strong>/ <strong class="markup--strong markup--p-strong"><em class="markup--em markup--p-em">downsampling</em></strong></p><figure name="b970" id="b970" class="graf graf--figure graf-after--p graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 537px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 76.8%;"></div><img class="graf-image" data-image-id="1*Kaaz9tbJoYzsxqlJVU1ukQ.png" data-width="1954" data-height="1500" src="https://cdn-images-1.medium.com/max/800/1*Kaaz9tbJoYzsxqlJVU1ukQ.png"></div></figure></div></div></section><section name="79c7" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="2911" id="2911" class="graf graf--h4 graf--leading">Avoid thread explosion</h4><figure name="b9f5" id="b9f5" class="graf graf--figure graf-after--h4"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 630px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 90%;"></div><img class="graf-image" data-image-id="1*dHbU_lBJiRKJEvZ0i9ILsw.png" data-width="2376" data-height="2138" src="https://cdn-images-1.medium.com/max/800/1*dHbU_lBJiRKJEvZ0i9ILsw.png"></div></figure><h3 name="05f0" id="05f0" class="graf graf--h3 graf-after--figure">Vector Artwork¬†Pipeline</h3><figure name="5a25" id="5a25" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 521px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 74.4%;"></div><img class="graf-image" data-image-id="1*T7mNNGpBh77ts26hRgYMRw.png" data-width="1248" data-height="928" src="https://cdn-images-1.medium.com/max/800/1*T7mNNGpBh77ts26hRgYMRw.png"></div></figure><h3 name="e2b5" id="e2b5" class="graf graf--h3 graf-after--figure">Vector Artwork Optimizations</h3><ul class="postList"><li name="f01e" id="f01e" class="graf graf--li graf-after--h3">Xcode raterizes artwork for relevant scale factors <strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">while compiling.</em></strong></li><li name="d784" id="d784" class="graf graf--li graf-after--li">Prerasterized artwork used when image is drawn at natural size.</li><li name="b758" id="b758" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">If artwork has fixed sizes, use multiple image assets instead of relying on vector rasterization.</em></strong></li></ul><h3 name="4676" id="4676" class="graf graf--h3 graf-after--li"><strong class="markup--strong markup--h3-strong">Custom Drawing vs UIImageView</strong></h3><ul class="postList"><li name="0c40" id="0c40" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Do not override UIView.draw()</strong> when you make a customized view.<br><em class="markup--em markup--li-em">This is an very </em><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">inefficient</em></strong><em class="markup--em markup--li-em"> way.</em></li><li name="8d33" id="8d33" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Use UIImageView.draw()</strong> because <strong class="markup--strong markup--li-strong">‚ÄòDecoded Image‚Äô is better</strong> than ‚ÄòBacking store‚Äô</li></ul><figure name="1afc" id="1afc" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 338px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 48.3%;"></div><img class="graf-image" data-image-id="1*bjJb-h2esL2IeL8TEsSY5g.png" data-width="3014" data-height="1456" src="https://cdn-images-1.medium.com/max/800/1*bjJb-h2esL2IeL8TEsSY5g.png"></div></figure><figure name="186d" id="186d" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 225px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 32.1%;"></div><img class="graf-image" data-image-id="1*CSI1eqJS28Emk2a5wniWeQ.gif" data-width="1118" data-height="359" src="https://cdn-images-1.medium.com/max/800/1*CSI1eqJS28Emk2a5wniWeQ.gif"></div><figcaption class="imageCaption"><strong class="markup--strong markup--figure-strong">UIImageView (Decoded image) </strong>vs <strong class="markup--strong markup--figure-strong">UIView (Backing¬†store)</strong></figcaption></figure><h3 name="abf3" id="abf3" class="graf graf--h3 graf-after--figure">Backing Store Memory¬†Costs</h3><ul class="postList"><li name="82fb" id="82fb" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Proportional</strong> to pixel size of view</li><li name="b91a" id="b91a" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Element size grows to accommodate color range used by drawing</strong></li><li name="243a" id="243a" class="graf graf--li graf-after--li">Setting<strong class="markup--strong markup--li-strong"> CALayer.contentsFormat</strong> opts out</li><li name="4b12" id="4b12" class="graf graf--li graf-after--li">Update<strong class="markup--strong markup--li-strong"> layerWillDraw(_:)</strong> implementations</li></ul><h3 name="469d" id="469d" class="graf graf--h3 graf-after--li">Reducing Backing Store¬†Use</h3></div><div class="section-inner sectionLayout--outsetColumn"><figure name="dd7d" id="dd7d" class="graf graf--figure graf--layoutOutsetCenter graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1000px; max-height: 564px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.39999999999999%;"></div><img class="graf-image" data-image-id="1*d92l7wnvX_SbY2fiT6QEaQ.png" data-width="2868" data-height="1618" src="https://cdn-images-1.medium.com/max/1000/1*d92l7wnvX_SbY2fiT6QEaQ.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="13c7" id="13c7" class="graf graf--h3 graf-after--figure">Drawing Off-Screen</h3><ul class="postList"><li name="02b1" id="02b1" class="graf graf--li graf-after--h3">Use <strong class="markup--strong markup--li-strong">UIGrahpicsImageRenderer to create and draw to an imag buffer</strong></li><li name="9676" id="9676" class="graf graf--li graf-after--li">Supports, Wide Color, unlike <strong class="markup--strong markup--li-strong">UIGraphicBeginContext( )</strong></li><li name="6586" id="6586" class="graf graf--li graf-after--li">Combine with UIImageView for efficient offscreen rendering</li><li name="5e94" id="5e94" class="graf graf--li graf-after--li">Set <strong class="markup--strong markup--li-strong">prefersExtendedRange </strong>on<strong class="markup--strong markup--li-strong"> UIGraphicsImageRendererFormat </strong>for direct control <strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">(new)</em></strong></li><li name="2fb4" id="2fb4" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">UIImage.imageRendererFormat</strong> may offer an intermediate representation <strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">(new)</em></strong></li></ul><h3 name="bec6" id="bec6" class="graf graf--h3 graf-after--li">Advanced Image¬†Effects</h3><h4 name="ad8f" id="ad8f" class="graf graf--h4 graf-after--h3">Core Image</h4><ul class="postList"><li name="ee8d" id="ee8d" class="graf graf--li graf-after--h4">For <strong class="markup--strong markup--li-strong">realtime</strong> effects</li><li name="2a68" id="2a68" class="graf graf--li graf-after--li">UIImageView renders CIImage efficiently. <strong class="markup--strong markup--li-strong">UIImage.init(ciImage: )</strong></li></ul><h4 name="5dae" id="5dae" class="graf graf--h4 graf-after--li">Interfacing with other frameworks</h4><ul class="postList"><li name="5ed3" id="5ed3" class="graf graf--li graf-after--h4"><strong class="markup--strong markup--li-strong">CVPixelBuffer</strong> ( Data <strong class="markup--strong markup--li-strong">‚Üí</strong> Metal, Vision, Accelerate )</li><li name="23a3" id="23a3" class="graf graf--li graf-after--li">Use the best initializer‚Ää‚Äî‚Ää<strong class="markup--strong markup--li-strong">don‚Äôt unwind </strong>work that‚Äôs already been done</li><li name="86b8" id="86b8" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Guard</strong> against moving work GPU ‚Üî CPU</li><li name="6b51" id="6b51" class="graf graf--li graf-after--li graf--trailing"><strong class="markup--strong markup--li-strong">Ensure</strong> <strong class="markup--strong markup--li-strong">buffers</strong> are correct format for Accelerate</li></ul></div></div></section>
</section>