---
layout: post
title:  "Vision with Core ML"
subtitle: "WWDC 2018"
date:   2018-08-21 20:23:33 -0000
background: '/img/posts/wwdc18.png'
---




<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Vision with Core ML</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Vision with Core ML</h1>
</header>
<section data-field="subtitle" class="p-summary">
WWDC 2018
</section>
<section data-field="body" class="e-content">
<section name="61a2" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="25c3" id="25c3" class="graf graf--h3 graf--leading graf--title">Vision with Core ML</h3><h4 name="39a4" id="39a4" class="graf graf--h4 graf-after--h3 graf--subtitle"><a href="https://developer.apple.com/videos/play/wwdc2018/717/" data-href="https://developer.apple.com/videos/play/wwdc2018/717/" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">WWDC 2018</a></h4><h3 name="a60a" id="a60a" class="graf graf--h3 graf-after--h4">The Storyline</h3><p name="5b7f" id="5b7f" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Create an app helping shoppers identify item</strong></p><ul class="postList"><li name="2835" id="2835" class="graf graf--li graf-after--p">Train a custom classifier</li><li name="e549" id="e549" class="graf graf--li graf-after--li">Build an iOS app</li><li name="a776" id="a776" class="graf graf--li graf-after--li">Keep an eye on pitfalls</li></ul><figure name="64f1" id="64f1" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 393px; max-height: 703px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 178.9%;"></div><img class="graf-image" data-image-id="1*QH1gSpxGAE6n_r3hZKi5VQ.gif" data-width="393" data-height="703" src="https://cdn-images-1.medium.com/max/800/1*QH1gSpxGAE6n_r3hZKi5VQ.gif"></div></figure><h3 name="9aac" id="9aac" class="graf graf--h3 graf-after--figure">Our Training Regimen</h3><ul class="postList"><li name="141c" id="141c" class="graf graf--li graf-after--h3">Take pictures</li><li name="8614" id="8614" class="graf graf--li graf-after--li">Sort into folders —<strong class="markup--strong markup--li-strong"> the folder names are used as labels</strong></li><li name="ea4d" id="ea4d" class="graf graf--li graf-after--li">How much data do I need<br><strong class="markup--strong markup--li-strong">- Minimum of 10 per category but more is better<br>- Highly imbalanced datasets are har to train</strong></li><li name="efd8" id="efd8" class="graf graf--li graf-after--li">Augmentation adds some robustness on top of it but doesn’t replace variety</li></ul><figure name="3ada" id="3ada" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 93px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 13.3%;"></div><img class="graf-image" data-image-id="1*NOz8u2_NppNqYpFLBq8bzw.png" data-width="4644" data-height="618" src="https://cdn-images-1.medium.com/max/800/1*NOz8u2_NppNqYpFLBq8bzw.png"></div></figure><h3 name="8fdc" id="8fdc" class="graf graf--h3 graf-after--figure">Under the Hood</h3><figure name="cfbe" id="cfbe" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 597px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 85.3%;"></div><img class="graf-image" data-image-id="1*t6LVPGLIMYMha25g2kGGYw.png" data-width="2723" data-height="2322" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*t6LVPGLIMYMha25g2kGGYw.png"></div></figure><h3 name="688c" id="688c" class="graf graf--h3 graf-after--figure">Vision FeaturePrint.Scene</h3><p name="949f" id="949f" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Vision Frameworks FeaturePrint for Image Classfication</strong></p><ul class="postList"><li name="69de" id="69de" class="graf graf--li graf-after--p">Available through ImageClassifier training in Create ML</li><li name="9ac7" id="9ac7" class="graf graf--li graf-after--li">Trained on a very large dataset</li><li name="6847" id="6847" class="graf graf--li graf-after--li">Capable of predicting over 1000 categories</li><li name="5f36" id="5f36" class="graf graf--li graf-after--li">Powers user facing features in Photos</li><li name="e300" id="e300" class="graf graf--li graf-after--li">Continuous improvement (You might want to retrain in the future)</li><li name="7082" id="7082" class="graf graf--li graf-after--li">Already on device <br>- Smaller disk footprint for your custom model</li><li name="8d37" id="8d37" class="graf graf--li graf-after--li">Optimized for Apple devices</li></ul><figure name="ace3" id="ace3" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 658px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 94%;"></div><img class="graf-image" data-image-id="1*4U84fTLyz_utrcH8sBuTsg.png" data-width="1954" data-height="1836" src="https://cdn-images-1.medium.com/max/800/1*4U84fTLyz_utrcH8sBuTsg.png"></div></figure><figure name="a470" id="a470" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 204px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 29.2%;"></div><img class="graf-image" data-image-id="1*u104zH7qyg1ur4Urq2S2iQ.png" data-width="4664" data-height="1360" src="https://cdn-images-1.medium.com/max/800/1*u104zH7qyg1ur4Urq2S2iQ.png"></div></figure><h3 name="77e4" id="77e4" class="graf graf--h3 graf-after--figure">Refining the App</h3><h4 name="8865" id="8865" class="graf graf--h4 graf-after--h3"><strong class="markup--strong markup--h4-strong">Only classify when needed !</strong></h4><ul class="postList"><li name="ed1b" id="ed1b" class="graf graf--li graf-after--h4">Don’t run expensive tasks when not needed</li><li name="cbb5" id="cbb5" class="graf graf--li graf-after--li">AM I holding still?</li><li name="0cb7" id="0cb7" class="graf graf--li graf-after--li">Using registration<br>- Cheap and fast<br>- Camera holds still<br>- Subject is not moving</li><li name="2a46" id="2a46" class="graf graf--li graf-after--li"><code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">VNTranslationalImageRegistrationRequest</strong></code></li></ul><figure name="1f27" id="1f27" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 226px; max-height: 446px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 197.3%;"></div><img class="graf-image" data-image-id="1*g9YIv7F2mQcKsiBqxB1Vxg.gif" data-width="226" data-height="446" src="https://cdn-images-1.medium.com/max/800/1*g9YIv7F2mQcKsiBqxB1Vxg.gif"></div></figure><h4 name="3056" id="3056" class="graf graf--h4 graf-after--figure">Always have a backup plan</h4><ul class="postList"><li name="0905" id="0905" class="graf graf--li graf-after--h4">Classifications can be wrong</li><li name="d705" id="d705" class="graf graf--li graf-after--li">Event when confidence is high &gt; plan for it</li><li name="d130" id="d130" class="graf graf--li graf-after--li">Alternative identification<br>- Barcode reading</li></ul><figure name="eb8e" id="eb8e" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 698px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 99.8%;"></div><img class="graf-image" data-image-id="1*vRxYIUh_NG3_SDgivMYKRA.png" data-width="1718" data-height="1714" src="https://cdn-images-1.medium.com/max/800/1*vRxYIUh_NG3_SDgivMYKRA.png"></div></figure><h3 name="e082" id="e082" class="graf graf--h3 graf-after--figure">Demo</h3><p name="e0d5" id="e0d5" class="graf graf--p graf-after--h3"><a href="https://developer.apple.com/documentation/vision/classifying_images_with_vision_and_core_ml" data-href="https://developer.apple.com/documentation/vision/classifying_images_with_vision_and_core_ml" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Sample Link</strong></a></p><ul class="postList"><li name="9b5d" id="9b5d" class="graf graf--li graf-after--p">Using Registration for Scene Stability</li><li name="c9dd" id="c9dd" class="graf graf--li graf-after--li">Use the <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">VNSequenceRequestHandler</strong></code> with <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">VNTranslationalImageRegistrationRequest</strong></code></li><li name="ffe4" id="ffe4" class="graf graf--li graf-after--li">Compare against previous frame <br><code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">sequenceRequestHandler.perform([request], on: previousBuffer!)</strong></code></li><li name="6838" id="6838" class="graf graf--li graf-after--li">Registration is returned as pixels in the <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">alignmentObservation.alignmentTransform</strong></code></li><li name="f4a2" id="f4a2" class="graf graf--li graf-after--li">Analyze only when scene is stable</li><li name="917c" id="917c" class="graf graf--li graf-after--li">Create an <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">VNImageRequestHandler</strong></code> for the current frame and pass in the orientation</li><li name="659e" id="659e" class="graf graf--li graf-after--li">Perform Barcode and Image Classification together<br><code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">try imageRequestHandler.perform([barcodeDetection, imageClassification])</strong></code></li><li name="c8dd" id="c8dd" class="graf graf--li graf-after--li">Manage your buffers</li><li name="f6f0" id="f6f0" class="graf graf--li graf-after--li">Some Vision requests can take longer</li><li name="5aa8" id="5aa8" class="graf graf--li graf-after--li">Perform longer task asynchronously</li><li name="6e2a" id="6e2a" class="graf graf--li graf-after--li">Do not queue up more buffers than the camera can provide<br>- We only operate with a one deep queue in this example</li></ul><h4 name="60da" id="60da" class="graf graf--h4 graf-after--li">1. Take photos</h4><figure name="7067" id="7067" class="graf graf--figure graf-after--h4"><div class="aspectRatioPlaceholder is-locked" style="max-width: 395px; max-height: 703px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 178%;"></div><img class="graf-image" data-image-id="1*sOpKbxkhpjqZ1Q_GDTALDg.gif" data-width="395" data-height="703" src="https://cdn-images-1.medium.com/max/800/1*sOpKbxkhpjqZ1Q_GDTALDg.gif"></div></figure><h4 name="425e" id="425e" class="graf graf--h4 graf-after--figure">2. Make a Machine Leaning Model</h4><p name="aab9" id="aab9" class="graf graf--p graf-after--h4"><strong class="markup--strong markup--p-strong">Using the storyboard</strong></p><figure name="45e1" id="45e1" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 393px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.2%;"></div><img class="graf-image" data-image-id="1*5fz6OBTnauhF_KgPkx8f-Q.gif" data-width="1080" data-height="607" src="https://cdn-images-1.medium.com/max/800/1*5fz6OBTnauhF_KgPkx8f-Q.gif"></div></figure><figure name="a036" id="a036" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 393px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.2%;"></div><img class="graf-image" data-image-id="1*gLcnil45Sf2L8KOiABfl2w.gif" data-width="1080" data-height="607" src="https://cdn-images-1.medium.com/max/800/1*gLcnil45Sf2L8KOiABfl2w.gif"></div></figure><h4 name="a1b4" id="a1b4" class="graf graf--h4 graf-after--figure">3. Settings</h4><figure name="abdc" id="abdc" class="graf graf--figure graf-after--h4"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 428px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.199999999999996%;"></div><img class="graf-image" data-image-id="1*pXoPpDb6LcH_8L4C1l3Mlw.gif" data-width="1123" data-height="687" src="https://cdn-images-1.medium.com/max/800/1*pXoPpDb6LcH_8L4C1l3Mlw.gif"></div></figure><h4 name="95c8" id="95c8" class="graf graf--h4 graf-after--figure">4. Run</h4><figure name="f199" id="f199" class="graf graf--figure graf-after--h4"><div class="aspectRatioPlaceholder is-locked" style="max-width: 395px; max-height: 624px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 158%;"></div><img class="graf-image" data-image-id="1*PH1hGHcT08RSgB103hLS-g.gif" data-width="395" data-height="624" src="https://cdn-images-1.medium.com/max/800/1*PH1hGHcT08RSgB103hLS-g.gif"></div></figure><h3 name="197a" id="197a" class="graf graf--h3 graf-after--figure">Why not use just Core ML?</h3><ul class="postList"><li name="e88a" id="e88a" class="graf graf--li graf-after--h3">Vision does all the scaling and color conversion for you</li></ul><figure name="68e0" id="68e0" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 171px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24.5%;"></div><img class="graf-image" data-image-id="1*mDVTcf7S4TDJmZfYXBeWNg.png" data-width="3426" data-height="838" src="https://cdn-images-1.medium.com/max/800/1*mDVTcf7S4TDJmZfYXBeWNg.png"></div></figure><h3 name="84fa" id="84fa" class="graf graf--h3 graf-after--figure">Object Recognition</h3><ul class="postList"><li name="b485" id="b485" class="graf graf--li graf-after--h3">YOLO (You Only Look Once)</li><li name="72ad" id="72ad" class="graf graf--li graf-after--li">Fast Object Detection and Classification<br>- Label and Bounding Box<br>- Finds multiple and different objects</li><li name="5cbb" id="5cbb" class="graf graf--li graf-after--li">Train for custom objects<br>- Training is more involved than ImageClassifier</li></ul><h3 name="f6a1" id="f6a1" class="graf graf--h3 graf-after--li">Demo</h3><p name="b0a2" id="b0a2" class="graf graf--p graf-after--h3"><a href="https://developer.apple.com/documentation/vision/detecting_objects_in_still_images" data-href="https://developer.apple.com/documentation/vision/detecting_objects_in_still_images" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">Sample Link</strong></a></p><figure name="7acb" id="7acb" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 396px; max-height: 701px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 177%;"></div><img class="graf-image" data-image-id="1*9a6a_tnpHu_2Z-QP3EoNzg.gif" data-width="396" data-height="701" src="https://cdn-images-1.medium.com/max/800/1*9a6a_tnpHu_2Z-QP3EoNzg.gif"></div></figure><h3 name="8ab1" id="8ab1" class="graf graf--h3 graf-after--figure">VNRecognizedObjectObservation</h3><ul class="postList"><li name="0bf6" id="0bf6" class="graf graf--li graf-after--h3">Result of a <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">VNCoreMLModelRequest</strong></code></li><li name="0f01" id="0f01" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">New</strong> observation subclass <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">VNRecognizedObjectObservation</strong></code></li><li name="d809" id="d809" class="graf graf--li graf-after--li">YOLO based models made easy</li></ul><figure name="5210" id="5210" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 310px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 44.3%;"></div><img class="graf-image" data-image-id="1*Gvmw-oOnZLoLQU75T5gClA.png" data-width="4622" data-height="2048" src="https://cdn-images-1.medium.com/max/800/1*Gvmw-oOnZLoLQU75T5gClA.png"></div></figure><h3 name="f134" id="f134" class="graf graf--h3 graf-after--figure">Tracking</h3><p name="3f5e" id="3f5e" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">! Tracking is faster and smoother than re-detection !</strong></p><ul class="postList"><li name="724d" id="724d" class="graf graf--li graf-after--p">Use tracking to follow a detected object</li><li name="0e94" id="0e94" class="graf graf--li graf-after--li">Tracking is a lighter algorithm</li><li name="6067" id="6067" class="graf graf--li graf-after--li">Applies temporal smoothing</li></ul><h3 name="f82d" id="f82d" class="graf graf--h3 graf-after--li">Image Orientation</h3><ul class="postList"><li name="257f" id="257f" class="graf graf--li graf-after--h3">Not all algorithms are orientation agnostic</li><li name="c460" id="c460" class="graf graf--li graf-after--li">Images are not always upright<br><strong class="markup--strong markup--li-strong">- EXIF orientation defines what is upright</strong><br><strong class="markup--strong markup--li-strong">- When using a URL as input Vision reads the EXIF orientation from file</strong></li><li name="7f54" id="7f54" class="graf graf--li graf-after--li">Live from a capture feed<br>- Orientation has to be inferred from <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">UIDevice.current.orientation</strong></code><br>- Needs to be mapped to a <code class="markup--code markup--li-code"><strong class="markup--strong markup--li-strong">CGImagePropertyOrientation</strong></code></li></ul><h3 name="9a4c" id="9a4c" class="graf graf--h3 graf-after--li">Vision Coordinate System</h3><figure name="39c1" id="39c1" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 432px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.7%;"></div><img class="graf-image" data-image-id="1*Q13NgEEea1pRNMb6dErIpw.png" data-width="3797" data-height="2343" src="https://cdn-images-1.medium.com/max/800/1*Q13NgEEea1pRNMb6dErIpw.png"></div></figure><h3 name="b6ea" id="b6ea" class="graf graf--h3 graf-after--figure">Confidence Score</h3><ul class="postList"><li name="ea9a" id="ea9a" class="graf graf--li graf-after--h3">A log of algorithm can express how certain they are about the results</li><li name="d36c" id="d36c" class="graf graf--li graf-after--li">Confidence is expressed 0 ~ 1.0</li><li name="504e" id="504e" class="graf graf--li graf-after--li">The scale is not uniform across request types</li></div><div class="section-inner sectionLayout--fullWidth"></ul><figure name="b9da" id="b9da" class="graf graf--figure graf--layoutFillWidth graf-after--li"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 70.39999999999999%;"></div><img class="graf-image" data-image-id="1*C9xuEgWgGSq2axXdtpN3FA.png" data-width="2956" data-height="2082" src="https://cdn-images-1.medium.com/max/2000/1*C9xuEgWgGSq2axXdtpN3FA.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="5184" id="5184" class="graf graf--h3 graf-after--figure">Confidence Score Conclusion</h3><ul class="postList"><li name="2289" id="2289" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Does 1.0 mean it’s certainly correct ???? <br>- It fulfilled the criteria of the algorithm but our perception can differ</strong></li><li name="cc12" id="cc12" class="graf graf--li graf-after--li graf--trailing">Where the threshold is depends on the use case<br>- Labeling requires high confidence — Observe how your classifier behaves<br>- Search might want to include lower confidence scores as they are probable</li></ul></div></div></section>
</section>