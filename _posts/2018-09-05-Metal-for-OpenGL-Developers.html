---
layout: post
title:  "Metal for OpenGL Developers"
subtitle: "WWDC 2018"
date:   2018-09-05 20:23:33 -0000
background: '/img/posts/wwdc18.png'
---





<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Metal for OpenGL Developers</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Metal for OpenGL Developers</h1>
</header>
<section data-field="subtitle" class="p-summary">
WWDC 2018
</section>
<section data-field="body" class="e-content">
<section name="e9d4" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="6082" id="6082" class="graf graf--h3 graf--leading graf--title">Metal for OpenGL Developers</h3><h4 name="47ea" id="47ea" class="graf graf--h4 graf-after--h3 graf--subtitle"><a href="https://developer.apple.com/videos/play/wwdc2018/604/" data-href="https://developer.apple.com/videos/play/wwdc2018/604/" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">WWDC 2018</a></h4><figure name="2461" id="2461" class="graf graf--figure graf-after--h4"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 151px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 21.5%;"></div><img class="graf-image" data-image-id="1*9C5ZJ8l8UDoQu3T3hXgNqQ.png" data-width="3306" data-height="712" src="https://cdn-images-1.medium.com/max/800/1*9C5ZJ8l8UDoQu3T3hXgNqQ.png"></div></figure><ul class="postList"><li name="6119" id="6119" class="graf graf--li graf-after--figure">These legacy APIs are deprecated</li><li name="60f7" id="60f7" class="graf graf--li graf-after--li">Still available in iOS 12, macOS 10.14 and tvOS 12</li><li name="359e" id="359e" class="graf graf--li graf-after--li">Begin transitioning to Metal</li></ul><h3 name="a6e4" id="a6e4" class="graf graf--h3 graf-after--li">Choosing an Approach</h3><ul class="postList"><li name="5abd" id="5abd" class="graf graf--li graf-after--h3">High-level Apple frameworks<br>- SpriteKit, SceneKit, and Core Image</li><li name="d769" id="d769" class="graf graf--li graf-after--li">3rd-party engine<br>- Unity, Unreal, Lumberyard, etc<br>- Update to lastest version</li></ul><h3 name="63e8" id="63e8" class="graf graf--h3 graf-after--li">Challenges with OpenGL</h3><ul class="postList"><li name="f7e4" id="f7e4" class="graf graf--li graf-after--h3">OpenGL designed more than<strong class="markup--strong markup--li-strong"> 25 years ago</strong><br>- Core architecture reflects the origin of 3D graphics<br>- Extensions retrofitted some GPU feature</li><li name="97fb" id="97fb" class="graf graf--li graf-after--li">Fundamental design choices based on past principles<br>- <strong class="markup--strong markup--li-strong">GPU pipeline has changed</strong><br>- <strong class="markup--strong markup--li-strong">Multithreaded operation not considered</strong><br>- <strong class="markup--strong markup--li-strong">Asynchronous processing, not core</strong></li></ul><h3 name="9a2b" id="9a2b" class="graf graf--h3 graf-after--li">Design Goals for Metal</h3><ul class="postList"><li name="e83d" id="e83d" class="graf graf--li graf-after--h3">Efficient GPU interaction<br>- Low CPU overhead<br>- Multithreaded execution<br>- Predictable operation<br>- Resource and synchronization control</li><li name="80ef" id="80ef" class="graf graf--li graf-after--li">Approachable to OpenGL developers</li><li name="9bb1" id="9bb1" class="graf graf--li graf-after--li">Built for modern and Apple-design GPUs</li></ul><h3 name="3f9e" id="3f9e" class="graf graf--h3 graf-after--li">Key Conceptual Differences</h3><ul class="postList"><li name="cbe7" id="cbe7" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Expensive operations less frequent<br>- </strong>Expensive CPU operations performed less often<br>- More GPU command generation during object creation<br>- Less needed when rendering</li><li name="f84d" id="f84d" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Modern GPU pipeline</strong><br>- Reflects the modern GPU architectures<br>- Closer match yields less costly translation to GPU commands<br>- State grouped more efficiently</li><li name="043c" id="043c" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Multithreaded execution<br></strong>- Designed for multithreaded execution<br>- Clear rules for multithreaded usage<br>- Cross thread object usability</li><li name="c30c" id="c30c" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Execution model</strong><br>- True interaction between software and GPU<br>- Predictable operation allows efficient designs<br>- Thinner stack between application and GPU</li></ul><figure name="dc1c" id="dc1c" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 408px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 58.199999999999996%;"></div><img class="graf-image" data-image-id="1*1NQqC7q6sfEvjUB47atrPA.png" data-width="3740" data-height="2178" src="https://cdn-images-1.medium.com/max/800/1*1NQqC7q6sfEvjUB47atrPA.png"></div><figcaption class="imageCaption">Open GL</figcaption></figure><figure name="3ba5" id="3ba5" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 394px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="1*1Qyc4QWwtk4dfxNlsNmEwQ.gif" data-width="1280" data-height="720" src="https://cdn-images-1.medium.com/max/800/1*1Qyc4QWwtk4dfxNlsNmEwQ.gif"></div><figcaption class="imageCaption">Metal Single Buffer</figcaption></figure><figure name="09d8" id="09d8" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 394px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.3%;"></div><img class="graf-image" data-image-id="1*P6q4ag1xEw7vYpvjboV2Hw.gif" data-width="1280" data-height="720" src="https://cdn-images-1.medium.com/max/800/1*P6q4ag1xEw7vYpvjboV2Hw.gif"></div><figcaption class="imageCaption">Metal Muti-Buffer</figcaption></figure><h3 name="5551" id="5551" class="graf graf--h3 graf-after--figure">Command Encoders</h3><ul class="postList"><li name="0d5a" id="0d5a" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Render Command Encoder</strong></li><li name="4d78" id="4d78" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Blit Command Encoder</strong></li><li name="d15a" id="d15a" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Compute Command Encoder</strong></li></ul><h3 name="f097" id="f097" class="graf graf--h3 graf-after--li">Render Command Encoder</h3><ul class="postList"><li name="3d3d" id="3d3d" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Commands for render pass</strong><br>- Encodes a series of render commands<br>- Also called a <strong class="markup--strong markup--li-strong">Render Pass</strong><br>- Set render object for the graphics pipeline <strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">( </em></strong><em class="markup--em markup--li-em">Buffer, texture, shaders </em><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">)</em></strong><br>- Issue draw commands <strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">( </em></strong><em class="markup--em markup--li-em">draw primitives, draw index primitives, instanced draws </em><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">)</em></strong></li><li name="2a9b" id="2a9b" class="graf graf--li graf-after--li">Render targets<br>- Associated with a set of render targets <strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">( </em></strong><em class="markup--em markup--li-em">Textures for rendering </em><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">)</em></strong><br>- Specify a set of render targets upon creation<br>- All draw commands directed to these for lifetime of encoder<br>- New render targets need a new encoder<br>- Clear delineation between sets of render targets</li></ul><h3 name="f1d9" id="f1d9" class="graf graf--h3 graf-after--li">Render Object</h3><ul class="postList"><li name="777a" id="777a" class="graf graf--li graf-after--h3">Textures</li><li name="79e3" id="79e3" class="graf graf--li graf-after--li">Buffers</li><li name="7989" id="7989" class="graf graf--li graf-after--li">Samplers</li><li name="d76f" id="d76f" class="graf graf--li graf-after--li">Render pipeline states</li><li name="46e4" id="46e4" class="graf graf--li graf-after--li">Depth stencil states</li></ul><h3 name="e750" id="e750" class="graf graf--h3 graf-after--li">Render Object creation</h3><ul class="postList"><li name="c5b3" id="c5b3" class="graf graf--li graf-after--h3">Create from a device<br>- Usable only on the device</li><li name="4a11" id="4a11" class="graf graf--li graf-after--li">Object state set at creation<br>- <strong class="markup--strong markup--li-strong">Descriptor</strong> object specifies properties for render object</li><li name="5edc" id="5edc" class="graf graf--li graf-after--li">State set at creation fixed for the lifetime of the object<br>- Image data of textures and values in buffers can change</li><li name="b37e" id="b37e" class="graf graf--li graf-after--li">Metal compiles objects into GPU state once<br><strong class="markup--strong markup--li-strong">- Never needs to check for changes and recompile</strong></li><li name="c24b" id="c24b" class="graf graf--li graf-after--li">Multithreaded usage more efficient<br>- Metal does not need to protect state from changes on other threads</li></ul><h3 name="7a4f" id="7a4f" class="graf graf--h3 graf-after--li">Metal Porting</h3><figure name="afbf" id="afbf" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 317px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45.300000000000004%;"></div><img class="graf-image" data-image-id="1*VkmwM6c1KX6F7YLydKXhaA.png" data-width="4484" data-height="2032" src="https://cdn-images-1.medium.com/max/800/1*VkmwM6c1KX6F7YLydKXhaA.png"></div></figure><h3 name="d061" id="d061" class="graf graf--h3 graf-after--figure">Metal Shading Language</h3><ul class="postList"><li name="d92d" id="d92d" class="graf graf--li graf-after--h3">Based on C++<br>- Classes, templates, structs, enums, namespaces</li><li name="d1cf" id="d1cf" class="graf graf--li graf-after--li">Built-in types for vectors and matrices</li><li name="e45d" id="e45d" class="graf graf--li graf-after--li">Built-in functions and operators</li><li name="a34a" id="a34a" class="graf graf--li graf-after--li">Built-in classes for textures and samplers</li></ul><figure name="6895" id="6895" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 812px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 116.10000000000001%;"></div><img class="graf-image" data-image-id="1*e_7FKFAjHJOojqSVtPeuvg.png" data-width="4308" data-height="5000" src="https://cdn-images-1.medium.com/max/800/1*e_7FKFAjHJOojqSVtPeuvg.png"></div></figure><h3 name="e5bc" id="e5bc" class="graf graf--h3 graf-after--figure">SIMD Type Library</h3><p name="ee39" id="ee39" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Types for shader development</strong></p><ul class="postList"><li name="27d6" id="27d6" class="graf graf--li graf-after--p">Vector and matrix types</li><li name="ec76" id="ec76" class="graf graf--li graf-after--li">Usable with Metal shading language and application code</li></ul><figure name="b1ea" id="b1ea" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 221px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 31.6%;"></div><img class="graf-image" data-image-id="1*fe5YQvFU9RBRQRw9ekmIXg.png" data-width="4832" data-height="1528" src="https://cdn-images-1.medium.com/max/800/1*fe5YQvFU9RBRQRw9ekmIXg.png"></div></figure><h3 name="bab5" id="bab5" class="graf graf--h3 graf-after--figure">Shader Compilation</h3><p name="b239" id="b239" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Build with Xcode</strong></p><ul class="postList"><li name="f767" id="f767" class="graf graf--li graf-after--p">Xcode compiles shaders into a Metal library (.metallib)</li><li name="45c8" id="45c8" class="graf graf--li graf-after--li">Front-end compilation to binary intermediate representation</li><li name="da35" id="da35" class="graf graf--li graf-after--li">Avoids parsing time on customer systems</li><li name="e4bc" id="e4bc" class="graf graf--li graf-after--li">By default, all shaders built into default.metallib<br>- Placed in app bundle for run time retrieval</li></ul><h3 name="9cf4" id="9cf4" class="graf graf--h3 graf-after--li">Runtime Shader Compilation ⚠️</h3><ul class="postList"><li name="4be4" id="4be4" class="graf graf--li graf-after--h3">Also can build shaders from source at runtime</li><li name="a5b0" id="a5b0" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Significant disadvantages</strong><br>- Full shader compilation occurs at runtime<br>- Compilation errors less obvious<br>- No header sharing between application and runtime built shaders</li><li name="654a" id="654a" class="graf graf--li graf-after--li">Build time compilation recommended</li></ul><h3 name="8d7b" id="8d7b" class="graf graf--h3 graf-after--li">Devices</h3><ul class="postList"><li name="f01b" id="f01b" class="graf graf--li graf-after--h3">A device represents one GPU</li><li name="17e9" id="17e9" class="graf graf--li graf-after--li">Create render objects<br>- Texture, buffers, pipelines</li><li name="ab6d" id="ab6d" class="graf graf--li graf-after--li">macOS multiple devices may be available</li><li name="a6b5" id="a6b5" class="graf graf--li graf-after--li">Default device suitable for most applications</li></ul><figure name="7a37" id="7a37" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 106px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 15.2%;"></div><img class="graf-image" data-image-id="1*KLIw94YjAvgt-DCmm4DLOw.png" data-width="2726" data-height="414" src="https://cdn-images-1.medium.com/max/800/1*KLIw94YjAvgt-DCmm4DLOw.png"></div></figure><figure name="31f0" id="31f0" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 360px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 51.5%;"></div><img class="graf-image" data-image-id="1*tXNQp91DrDNafxV-5uQUjw.png" data-width="4780" data-height="2460" src="https://cdn-images-1.medium.com/max/800/1*tXNQp91DrDNafxV-5uQUjw.png"></div></figure><h3 name="0272" id="0272" class="graf graf--h3 graf-after--figure">Command Queues</h3><ul class="postList"><li name="f6f3" id="f6f3" class="graf graf--li graf-after--h3">Queue created from a device</li><li name="14cd" id="14cd" class="graf graf--li graf-after--li">Queue execute command buffers in order<br>- Create queue at initialization</li><li name="90e2" id="90e2" class="graf graf--li graf-after--li">Typically one queue sufficient</li></ul><h3 name="8561" id="8561" class="graf graf--h3 graf-after--li">Texture</h3><figure name="f217" id="f217" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 779px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 111.20000000000002%;"></div><img class="graf-image" data-image-id="1*0FWV9RjVrDu5ow0u17zOaw.png" data-width="996" data-height="1108" src="https://cdn-images-1.medium.com/max/800/1*0FWV9RjVrDu5ow0u17zOaw.png"></div></figure><h3 name="38d9" id="38d9" class="graf graf--h3 graf-after--figure">Storage Modes</h3><figure name="b712" id="b712" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 204px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 29.2%;"></div><img class="graf-image" data-image-id="1*HSMKrN1TbLuSNvYsbao5lA.png" data-width="4276" data-height="1248" src="https://cdn-images-1.medium.com/max/800/1*HSMKrN1TbLuSNvYsbao5lA.png"></div><figcaption class="imageCaption">Shared storage</figcaption></figure><figure name="cbbc" id="cbbc" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 223px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 31.900000000000002%;"></div><img class="graf-image" data-image-id="1*T2qCX7Fp1mnDy8y4BGNDhw.png" data-width="4400" data-height="1404" src="https://cdn-images-1.medium.com/max/800/1*T2qCX7Fp1mnDy8y4BGNDhw.png"></div><figcaption class="imageCaption">Private storage</figcaption></figure><figure name="b6a6" id="b6a6" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 225px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 32.2%;"></div><img class="graf-image" data-image-id="1*Skjz5OXRVN-qaJLVdGbeTA.png" data-width="4386" data-height="1412" src="https://cdn-images-1.medium.com/max/800/1*Skjz5OXRVN-qaJLVdGbeTA.png"></div><figcaption class="imageCaption">Managed storage</figcaption></figure><figure name="e4ae" id="e4ae" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 231px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 33%;"></div><img class="graf-image" data-image-id="1*KaO24-l4-g1bagKn8GAvPA.png" data-width="3978" data-height="1312" src="https://cdn-images-1.medium.com/max/800/1*KaO24-l4-g1bagKn8GAvPA.png"></div></figure><figure name="3d98" id="3d98" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 318px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45.4%;"></div><img class="graf-image" data-image-id="1*xnCH2H7xd7SkuiGvpodKBw.png" data-width="4244" data-height="1926" src="https://cdn-images-1.medium.com/max/800/1*xnCH2H7xd7SkuiGvpodKBw.png"></div></figure><h3 name="8bd2" id="8bd2" class="graf graf--h3 graf-after--figure">Texture Differences ⚠️</h3><ul class="postList"><li name="ed8f" id="ed8f" class="graf graf--li graf-after--h3">Sampler state never part of texture<br>- Wrap modes, filtering, min/max LOD</li><li name="8829" id="8829" class="graf graf--li graf-after--li">Texture image data not flipped<br><strong class="markup--strong markup--li-strong">- OpenGL uses <em class="markup--em markup--li-em">bottom-left </em>origin, Metal uses <em class="markup--em markup--li-em">top-left </em>origin</strong></li><li name="33c4" id="33c4" class="graf graf--li graf-after--li">Metal does not perform format conversion</li></ul><h3 name="9da3" id="9da3" class="graf graf--h3 graf-after--li">Buffers</h3><ul class="postList"><li name="957c" id="957c" class="graf graf--li graf-after--h3">Metal uses buffers for vertices, indices, and all uniform data</li><li name="9ed3" id="9ed3" class="graf graf--li graf-after--li">OpenGL’s vertex, element, and uniform buffer are similar<br>- Easier to port apps that have adopted these</li></ul><figure name="5978" id="5978" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 221px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 31.6%;"></div><img class="graf-image" data-image-id="1*SIC8n1BHrT4fTHmhs_4NLg.png" data-width="4128" data-height="1304" src="https://cdn-images-1.medium.com/max/800/1*SIC8n1BHrT4fTHmhs_4NLg.png"></div></figure><figure name="629b" id="629b" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 531px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 75.8%;"></div><img class="graf-image" data-image-id="1*8wtHHNi9E2uPwULxEe2M2A.png" data-width="1744" data-height="1322" src="https://cdn-images-1.medium.com/max/800/1*8wtHHNi9E2uPwULxEe2M2A.png"></div></figure><h3 name="1723" id="1723" class="graf graf--h3 graf-after--figure">Notes About Buffer Data ⚠️</h3><p name="eeab" id="eeab" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">!!! Pay attention to alignment !!!</strong></p><figure name="8448" id="8448" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 265px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 37.8%;"></div><img class="graf-image" data-image-id="1*FzkjV2EZnxgn-YdIF8gnbA.png" data-width="4620" data-height="1748" src="https://cdn-images-1.medium.com/max/800/1*FzkjV2EZnxgn-YdIF8gnbA.png"></div></figure><ul class="postList"><li name="0458" id="0458" class="graf graf--li graf-after--figure">SIMD libraries vector and matrix types follow same rules as Metal shaders</li><li name="a9a0" id="a9a0" class="graf graf--li graf-after--li">Special packed vector types available to shaders<br>- <code class="markup--code markup--li-code">packed_float3</code> consumes 12 bytes<br>- <code class="markup--code markup--li-code">packed_half3</code> consumes 6 bytes</li><li name="e650" id="e650" class="graf graf--li graf-after--li">Cannot directly operate on packed types<br>- Cast to non-packed type required</li></ul><h3 name="375c" id="375c" class="graf graf--h3 graf-after--li">Storage Modes for Porting ⚠️</h3><ul class="postList"><li name="8b2c" id="8b2c" class="graf graf--li graf-after--h3">Use most convient storage modes<br>- Easier access to data</li><li name="5d68" id="5d68" class="graf graf--li graf-after--li">On iOS<br>- Create all textures and buffers with <code class="markup--code markup--li-code">MTLStorageModeShared</code></li><li name="6182" id="6182" class="graf graf--li graf-after--li">On macOS<br>- Create all textures with <code class="markup--code markup--li-code">MTLStorageModeManged</code><br>- Make judicious use of <code class="markup--code markup--li-code">MTLStorageModeShared</code> for buffers<br> Separate GPU only data from CPU accessible data</li></ul><h3 name="89cb" id="89cb" class="graf graf--h3 graf-after--li">MetalKit</h3><p name="faa0" id="faa0" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Texture and buffer utilities</strong></p><ul class="postList"><li name="102a" id="102a" class="graf graf--li graf-after--p">Texture Loading<br>- Textures from KTX, PVR, JPG, PNG, TIFF, etc</li><li name="48ec" id="48ec" class="graf graf--li graf-after--li">Model Loading<br>- Vertex buffers from USD, OBJ, Alembic, etc</li></ul><h3 name="73e0" id="73e0" class="graf graf--h3 graf-after--li">PipeLines</h3><figure name="8edf" id="8edf" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 516px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 73.7%;"></div><img class="graf-image" data-image-id="1*3v1at5zuXqfnsJoMh-Su8A.png" data-width="1041" data-height="767" src="https://cdn-images-1.medium.com/max/800/1*3v1at5zuXqfnsJoMh-Su8A.png"></div></figure><figure name="8540" id="8540" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 339px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 48.4%;"></div><img class="graf-image" data-image-id="1*fSCkI0rwFmv_jACA0ij1Hw.png" data-width="4628" data-height="2238" src="https://cdn-images-1.medium.com/max/800/1*fSCkI0rwFmv_jACA0ij1Hw.png"></div></figure><h3 name="9e58" id="9e58" class="graf graf--h3 graf-after--figure">Pipeline Differences</h3><figure name="3b46" id="3b46" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 426px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 60.9%;"></div><img class="graf-image" data-image-id="1*JB3E92FgaTIQEMVmOZeLwQ.png" data-width="3510" data-height="2138" src="https://cdn-images-1.medium.com/max/800/1*JB3E92FgaTIQEMVmOZeLwQ.png"></div></figure><h3 name="cab2" id="cab2" class="graf graf--h3 graf-after--figure">Pipeline Building</h3><ul class="postList"><li name="5fcf" id="5fcf" class="graf graf--li graf-after--h3">Create at initialization<br>- Full compilation key advantage of state grouping<br>- Choose a canonical vertex layout for meshes<br>- Use a limited set of render target formats</li><li name="d99e" id="d99e" class="graf graf--li graf-after--li">Lazy creation at draw time ⚠️<br>- Store pipeline state objects in a dictionary using descriptor as key<br>- Construct descriptor at draw time with current state<br>- <strong class="markup--strong markup--li-strong">Retrieve existing pipeline from dictionary OR build new pipeline</strong></li></ul><h3 name="120c" id="120c" class="graf graf--h3 graf-after--li">Create Render Objects at Initialization</h3><ul class="postList"><li name="5267" id="5267" class="graf graf--li graf-after--h3">Object creation expensive<br>- Pipelines require backend compilation<br>- Buffers and textures need allocations</li><li name="0aa8" id="0aa8" class="graf graf--li graf-after--li">Once created, much faster usage during rendering</li></ul><h3 name="459c" id="459c" class="graf graf--h3 graf-after--li">Command Buffers</h3><ul class="postList"><li name="d36e" id="d36e" class="graf graf--li graf-after--h3">Explicit control over command buffer submission</li><li name="c674" id="c674" class="graf graf--li graf-after--li">Start with one command buffer per frame</li><li name="c222" id="c222" class="graf graf--li graf-after--li">Optionally split a frame into multiple command buffers to<br>- Submit early and get the GPU started<br>- Build commands on multiple threads</li><li name="9c87" id="9c87" class="graf graf--li graf-after--li">Completion handler invoked when execution is finished</li></ul><figure name="929c" id="929c" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 346px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 49.5%;"></div><img class="graf-image" data-image-id="1*-2oOaLho4ED5s08_6JAAFA.png" data-width="4866" data-height="2408" src="https://cdn-images-1.medium.com/max/800/1*-2oOaLho4ED5s08_6JAAFA.png"></div></figure><figure name="7579" id="7579" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 384px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 54.800000000000004%;"></div><img class="graf-image" data-image-id="1*RbOzj6q-k9JOEiZXwFmEpw.png" data-width="3520" data-height="1930" src="https://cdn-images-1.medium.com/max/800/1*RbOzj6q-k9JOEiZXwFmEpw.png"></div></figure><figure name="95b8" id="95b8" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 441px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 63%;"></div><img class="graf-image" data-image-id="1*IV1RzpvYVB0Gz4o7tteVFg.png" data-width="3654" data-height="2302" src="https://cdn-images-1.medium.com/max/800/1*IV1RzpvYVB0Gz4o7tteVFg.png"></div></figure><h3 name="8894" id="8894" class="graf graf--h3 graf-after--figure">Resource Updates</h3><ul class="postList"><li name="71a5" id="71a5" class="graf graf--li graf-after--h3">Resources are explicitly managed in Metal</li><li name="86e0" id="86e0" class="graf graf--li graf-after--li">No implicit synchronization like OpenGL</li><li name="e8fb" id="e8fb" class="graf graf--li graf-after--li">Allows for fine gained synchronization</li><li name="c2d8" id="c2d8" class="graf graf--li graf-after--li">Application has complete control</li><li name="4836" id="4836" class="graf graf--li graf-after--li">Best model dependent on usage<br>- Triple buffering recommended</li></ul><figure name="f772" id="f772" class="graf graf--figure graf-after--li graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 366px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 52.300000000000004%;"></div><img class="graf-image" data-image-id="1*cmRMPRJKCJQt9BqLyfTWAg.png" data-width="2292" data-height="1198" src="https://cdn-images-1.medium.com/max/800/1*cmRMPRJKCJQt9BqLyfTWAg.png"></div></figure></div></div></section><section name="e110" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h4 name="f3ad" id="f3ad" class="graf graf--h4 graf--leading">Problem</h4><figure name="f2e9" id="f2e9" class="graf graf--figure graf-after--h4 graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 300px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 42.8%;"></div><img class="graf-image" data-image-id="1*eEcyRp9d5Ou3SMsTz4mjJg.gif" data-width="1142" data-height="489" src="https://cdn-images-1.medium.com/max/800/1*eEcyRp9d5Ou3SMsTz4mjJg.gif"></div><figcaption class="imageCaption"><strong class="markup--strong markup--figure-strong">Without synchronization</strong></figcaption></figure></div></div></section><section name="bce7" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="9559" id="9559" class="graf graf--h3 graf--leading">Temporary Solution ⚠️</h3><p name="5dff" id="5dff" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Synchronous wait after every frame</strong></p><figure name="bf88" id="bf88" class="graf graf--figure graf-after--p graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 320px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45.7%;"></div><img class="graf-image" data-image-id="1*98g9hclkBSAVsARNn6hirQ.png" data-width="4300" data-height="1964" src="https://cdn-images-1.medium.com/max/800/1*98g9hclkBSAVsARNn6hirQ.png"></div></figure></div></div></section><section name="8c3a" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="3b81" id="3b81" class="graf graf--h3 graf--leading">Triple Buffering</h3><p name="8401" id="8401" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Shared buffer pool 👍</strong></p><figure name="20b0" id="20b0" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 323px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 46.1%;"></div><img class="graf-image" data-image-id="1*Bs-Uhv2Di7ukpfLLxKzIrg.gif" data-width="1158" data-height="534" src="https://cdn-images-1.medium.com/max/800/1*Bs-Uhv2Di7ukpfLLxKzIrg.gif"></div></figure><figure name="fc3f" id="fc3f" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 601px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 85.9%;"></div><img class="graf-image" data-image-id="1*a9nQku3G6SxhsuA1H7XZoA.png" data-width="5000" data-height="4293" src="https://cdn-images-1.medium.com/max/800/1*a9nQku3G6SxhsuA1H7XZoA.png"></div></figure><h3 name="8e28" id="8e28" class="graf graf--h3 graf-after--figure">Render Encoders</h3><figure name="2146" id="2146" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 350px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 50%;"></div><img class="graf-image" data-image-id="1*AkXjrWnuj3QOCXquMjJ_EQ.png" data-width="4766" data-height="2384" src="https://cdn-images-1.medium.com/max/800/1*AkXjrWnuj3QOCXquMjJ_EQ.png"></div></figure><h3 name="e086" id="e086" class="graf graf--h3 graf-after--figure">Render Pass Descriptor</h3><figure name="7908" id="7908" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 287px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 40.9%;"></div><img class="graf-image" data-image-id="1*f6ZmDQ-I05KK77qFUuanMA.png" data-width="4494" data-height="1840" src="https://cdn-images-1.medium.com/max/800/1*f6ZmDQ-I05KK77qFUuanMA.png"></div></figure><h3 name="2b0f" id="2b0f" class="graf graf--h3 graf-after--figure">Render Pass Descriptor</h3><figure name="69d2" id="69d2" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 287px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 40.9%;"></div><img class="graf-image" data-image-id="1*f6ZmDQ-I05KK77qFUuanMA.png" data-width="4494" data-height="1840" src="https://cdn-images-1.medium.com/max/800/1*f6ZmDQ-I05KK77qFUuanMA.png"></div></figure><h3 name="cbee" id="cbee" class="graf graf--h3 graf-after--figure">Render Pass Setup</h3><figure name="d64f" id="d64f" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 109px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 15.6%;"></div><img class="graf-image" data-image-id="1*pwnBjCtyhDDfxlpWJJbUTg.png" data-width="4720" data-height="736" src="https://cdn-images-1.medium.com/max/800/1*pwnBjCtyhDDfxlpWJJbUTg.png"></div></figure><h3 name="38bc" id="38bc" class="graf graf--h3 graf-after--figure">ender Pass Load and Store Actions</h3><figure name="822b" id="822b" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 263px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 37.6%;"></div><img class="graf-image" data-image-id="1*rblBLRxgfrMxF4HsGosd-g.png" data-width="4556" data-height="1712" src="https://cdn-images-1.medium.com/max/800/1*rblBLRxgfrMxF4HsGosd-g.png"></div></figure><figure name="beac" id="beac" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 334px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 47.699999999999996%;"></div><img class="graf-image" data-image-id="1*ypz_myGDMaa_sKy-0PQtsg.png" data-width="4362" data-height="2080" src="https://cdn-images-1.medium.com/max/800/1*ypz_myGDMaa_sKy-0PQtsg.png"></div></figure><figure name="b6df" id="b6df" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 148px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 21.2%;"></div><img class="graf-image" data-image-id="1*1Xd-UaW_6349ekGQskIY1A.png" data-width="4720" data-height="1000" src="https://cdn-images-1.medium.com/max/800/1*1Xd-UaW_6349ekGQskIY1A.png"></div></figure><h3 name="8b0e" id="8b0e" class="graf graf--h3 graf-after--figure">Rendering with OpenGL</h3><figure name="b870" id="b870" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 324px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 46.2%;"></div><img class="graf-image" data-image-id="1*wS8tCa2Ae958IFJ4JpJouQ.png" data-width="3656" data-height="1690" src="https://cdn-images-1.medium.com/max/800/1*wS8tCa2Ae958IFJ4JpJouQ.png"></div></figure><h3 name="6b12" id="6b12" class="graf graf--h3 graf-after--figure">Rendering with Metal</h3><figure name="73f3" id="73f3" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 315px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 45%;"></div><img class="graf-image" data-image-id="1*nVVfP3r1IqVSWzH3Xwx2bg.png" data-width="4620" data-height="2078" src="https://cdn-images-1.medium.com/max/800/1*nVVfP3r1IqVSWzH3Xwx2bg.png"></div></figure><h3 name="7df0" id="7df0" class="graf graf--h3 graf-after--figure">Display</h3><p name="f19c" id="f19c" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Drawables and presentation</strong></p><ul class="postList"><li name="210d" id="210d" class="graf graf--li graf-after--p">Drawables — Textures for on screen display</li><li name="8a86" id="8a86" class="graf graf--li graf-after--li">Each frame MTKView provides<br>- Drawable texture<br>- Render pass descriptor setup with the drawable</li><li name="49ae" id="49ae" class="graf graf--li graf-after--li">Render to drawables like any other texture</li><li name="9d14" id="9d14" class="graf graf--li graf-after--li">Present drawable when down rendering</li></ul><figure name="062a" id="062a" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 341px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 48.699999999999996%;"></div><img class="graf-image" data-image-id="1*Su4_3R3-BhsNzL3E39dggg.png" data-width="4798" data-height="2338" src="https://cdn-images-1.medium.com/max/800/1*Su4_3R3-BhsNzL3E39dggg.png"></div></figure><figure name="87ae" id="87ae" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 364px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 52%;"></div><img class="graf-image" data-image-id="1*q9J7JvZdgikz8VrSwnQESA.png" data-width="4812" data-height="2500" src="https://cdn-images-1.medium.com/max/800/1*q9J7JvZdgikz8VrSwnQESA.png"></div></figure><h3 name="d607" id="d607" class="graf graf--h3 graf-after--figure">Incrementally Porting ⚠️</h3><ul class="postList"><li name="5e00" id="5e00" class="graf graf--li graf-after--h3">Create shared Metal/OpenGL textures using IOSurface or CVPixelBuffer<br>- Render to texture on 1 API and read in the other</li><li name="cb7b" id="cb7b" class="graf graf--li graf-after--li">Can enabled mixed Metal/OpenGL applications</li><li name="84fd" id="84fd" class="graf graf--li graf-after--li"><a href="https://developer.apple.com/documentation/metal/mixing_metal_and_opengl_rendering_in_a_view" data-href="https://developer.apple.com/documentation/metal/mixing_metal_and_opengl_rendering_in_a_view" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong"><em class="markup--em markup--li-em">Sample Link</em></strong></a></li></ul><h3 name="1e4c" id="1e4c" class="graf graf--h3 graf-after--li">Multithreading</h3><p name="5121" id="5121" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Metal is designed to facilitate Multithreading</strong></p><ul class="postList"><li name="5f68" id="5f68" class="graf graf--li graf-after--p">Consider multithreading if application is CPU bound</li><li name="ddef" id="ddef" class="graf graf--li graf-after--li">Encode multiple command buffers simultaneously</li><li name="2b82" id="2b82" class="graf graf--li graf-after--li">Split single render pass using MTLParallelCommandEncoder</li></ul><h3 name="e80a" id="e80a" class="graf graf--h3 graf-after--li">Staying on the GPU</h3><ul class="postList"><li name="6aef" id="6aef" class="graf graf--li graf-after--h3">Metal natively supports compute</li><li name="45e9" id="45e9" class="graf graf--li graf-after--li">Performance benefits<br>- Reduces CPU utilization<br>- Reduces GPU-CPU synchronization points<br>- Free’s data bandwidth to the GPU</li><li name="fc06" id="fc06" class="graf graf--li graf-after--li">New algorithms possible<br>- Particle systems, physics, object culling</li></ul><h3 name="113c" id="113c" class="graf graf--h3 graf-after--li">Developer Tools</h3><p name="17c1" id="17c1" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">Debug and optimize your applications</strong></p><ul class="postList"><li name="58e3" id="58e3" class="graf graf--li graf-after--p">Xcode contains an advances set of GPU tools</li><li name="81c4" id="81c4" class="graf graf--li graf-after--li">Enable Metal’s API vaildation layer<br>- On by default when target run from Xcode</li></ul><figure name="6db5" id="6db5" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 429px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.3%;"></div><img class="graf-image" data-image-id="1*kpHrqyhP65FZqAda-rKU-w.png" data-width="3618" data-height="2218" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*kpHrqyhP65FZqAda-rKU-w.png"></div></figure><figure name="f1bc" id="f1bc" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 428px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.1%;"></div><img class="graf-image" data-image-id="1*9SwaPv6TjRNgdxeWu3-2ag.png" data-width="3618" data-height="2210" src="https://cdn-images-1.medium.com/max/800/1*9SwaPv6TjRNgdxeWu3-2ag.png"></div></figure><figure name="03ff" id="03ff" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 429px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.199999999999996%;"></div><img class="graf-image" data-image-id="1*Cr3FlW32Ukw-5N1fR4zTeA.png" data-width="3616" data-height="2214" src="https://cdn-images-1.medium.com/max/800/1*Cr3FlW32Ukw-5N1fR4zTeA.png"></div></figure><figure name="633b" id="633b" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 429px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.3%;"></div><img class="graf-image" data-image-id="1*f6Nj2ylbw8ov7I5J31JmhA.png" data-width="3618" data-height="2218" src="https://cdn-images-1.medium.com/max/800/1*f6Nj2ylbw8ov7I5J31JmhA.png"></div></figure><figure name="19af" id="19af" class="graf graf--figure graf-after--figure graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 428px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.199999999999996%;"></div><img class="graf-image" data-image-id="1*3r_vIfTOBVijHXQQpLV92w.png" data-width="3622" data-height="2216" src="https://cdn-images-1.medium.com/max/800/1*3r_vIfTOBVijHXQQpLV92w.png"></div></figure></div></div></section>
</section>