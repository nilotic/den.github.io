---
layout: post
title:  "Core Image: Performance, Prototyping, and Python"
subtitle: "WWDC 2018"
date:   2018-09-06 20:23:33 -0000
background: '/img/posts/wwdc18.png'
---




<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Core Image: Performance, Prototyping, and Python</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Core Image: Performance, Prototyping, and Python</h1>
</header>
<section data-field="subtitle" class="p-summary">
WWDC 2018
</section>
<section data-field="body" class="e-content">
<section name="4c7c" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="c9e9" id="c9e9" class="graf graf--h3 graf--leading graf--title">Core Image: Performance, Prototyping, and Python</h3><h4 name="5ae6" id="5ae6" class="graf graf--h4 graf-after--h3 graf--subtitle"><a href="https://developer.apple.com/videos/play/wwdc2018/719/" data-href="https://developer.apple.com/videos/play/wwdc2018/719/" class="markup--anchor markup--h4-anchor" rel="noopener" target="_blank">WWDC 2018</a></h4><h3 name="f833" id="f833" class="graf graf--h3 graf-after--h4">Core Image Performance APIs</h3><ul class="postList"><li name="d313" id="d313" class="graf graf--li graf-after--h3">Inserting intermediates</li><li name="8946" id="8946" class="graf graf--li graf-after--li">Kernel language features</li></ul><h3 name="8182" id="8182" class="graf graf--h3 graf-after--li">Inserting Intermediates</h3><figure name="10ca" id="10ca" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 393px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.2%;"></div><img class="graf-image" data-image-id="1*gyU8THTATCj0NzjNz-4I9w.gif" data-width="1000" data-height="562" src="https://cdn-images-1.medium.com/max/800/1*gyU8THTATCj0NzjNz-4I9w.gif"></div></figure><h3 name="2439" id="2439" class="graf graf--h3 graf-after--figure">Caching of Intermediates</h3><ul class="postList"><li name="f760" id="f760" class="graf graf--li graf-after--h3">Intermediates are cached by default</li><li name="26ec" id="26ec" class="graf graf--li graf-after--li">Can turn off for all renders on a CIContext<br><code class="markup--code markup--li-code u-paddingRight0 u-marginRight0">let context = CIContext(options: [<strong class="markup--strong markup--li-strong">.cacheIntermediates </strong>: false] );</code></li><li name="6fdb" id="6fdb" class="graf graf--li graf-after--li">Or turn on for specific intermediates<br><code class="markup--code markup--li-code u-paddingRight0 u-marginRight0">image.insertingIntermediate(cache: <strong class="markup--strong markup--li-strong">true</strong>);</code></li></ul><h3 name="2b58" id="2b58" class="graf graf--h3 graf-after--li">2 Ways to Write CIKernels</h3><figure name="5706" id="5706" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 412px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 58.9%;"></div><img class="graf-image" data-image-id="1*JjGT-j3QmcrGpucF0hODlw.png" data-width="3754" data-height="2210" src="https://cdn-images-1.medium.com/max/800/1*JjGT-j3QmcrGpucF0hODlw.png"></div></figure><h3 name="076d" id="076d" class="graf graf--h3 graf-after--figure">New Features for Better Performance</h3><ul class="postList"><li name="c840" id="c840" class="graf graf--li graf-after--h3">Half float support<br>- Faster operations (on A11 devices)<br>- Smaller registers increase utilization</li><li name="4d97" id="4d97" class="graf graf--li graf-after--li">Group reads<br>- 4 single-channel pixels per read</li><li name="7481" id="7481" class="graf graf--li graf-after--li">Group writes<br>- 4 pixels written per kernel execution</li></ul><figure name="dcc6" id="dcc6" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 240px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 34.4%;"></div><img class="graf-image" data-image-id="1*BFM5cfyOzt8rOlGebpE_aQ.png" data-width="4052" data-height="1392" src="https://cdn-images-1.medium.com/max/800/1*BFM5cfyOzt8rOlGebpE_aQ.png"></div></figure><figure name="9624" id="9624" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 324px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 46.2%;"></div><img class="graf-image" data-image-id="1*VgTnMzN-LeLwjvlp1gHSPQ.png" data-width="4104" data-height="1898" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*VgTnMzN-LeLwjvlp1gHSPQ.png"></div></figure><figure name="d7e2" id="d7e2" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 407px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 58.099999999999994%;"></div><img class="graf-image" data-image-id="1*_vQyDozXVJBvwdyoyyzdVA.png" data-width="3324" data-height="1932" src="https://cdn-images-1.medium.com/max/800/1*_vQyDozXVJBvwdyoyyzdVA.png"></div></figure><h3 name="c3d4" id="c3d4" class="graf graf--h3 graf-after--figure">Step 1: Convert to Metal</h3></div><div class="section-inner sectionLayout--outsetColumn"><figure name="0e41" id="0e41" class="graf graf--figure graf--layoutOutsetCenter graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1000px; max-height: 317px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 31.7%;"></div><img class="graf-image" data-image-id="1*jBuff6Vmkmt2_R3T1S7P3A.png" data-width="7051" data-height="2236" src="https://cdn-images-1.medium.com/max/1000/1*jBuff6Vmkmt2_R3T1S7P3A.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="bfa0" id="bfa0" class="graf graf--h3 graf-after--figure">Step2: Use half-float</h3></div><div class="section-inner sectionLayout--outsetColumn"><figure name="987c" id="987c" class="graf graf--figure graf--layoutOutsetCenter graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 1000px; max-height: 324px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 32.4%;"></div><img class="graf-image" data-image-id="1*k2EQ32Hq2wzhjDjakyNu1w.png" data-width="6635" data-height="2151" src="https://cdn-images-1.medium.com/max/1000/1*k2EQ32Hq2wzhjDjakyNu1w.png"></div></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="3ff1" id="3ff1" class="graf graf--h3 graf-after--figure">Step 3: Use Group reads and Write</h3><ul class="postList"><li name="dfdc" id="dfdc" class="graf graf--li graf-after--h3">2x Faster kernel execution time</li><li name="4cb5" id="4cb5" class="graf graf--li graf-after--li"><a href="https://developer.apple.com/documentation/coreimage/writing_custom_kernels" data-href="https://developer.apple.com/documentation/coreimage/writing_custom_kernels" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">https://developer.apple.com/documentation/coreimage/writing_custom_kernels</a></li></ul><figure name="9dda" id="9dda" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 393px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.10000000000001%;"></div><img class="graf-image" data-image-id="1*kQITGY1zAtLTFlYoWG3q5g.gif" data-width="720" data-height="404" src="https://cdn-images-1.medium.com/max/800/1*kQITGY1zAtLTFlYoWG3q5g.gif"></div></figure><h3 name="7d12" id="7d12" class="graf graf--h3 graf-after--figure">PyCoreImage</h3><figure name="ea43" id="ea43" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 351px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 50.2%;"></div><img class="graf-image" data-image-id="1*r0iJuC_ZSfiVDXohKi5w4Q.png" data-width="4328" data-height="2172" src="https://cdn-images-1.medium.com/max/800/1*r0iJuC_ZSfiVDXohKi5w4Q.png"></div></figure><figure name="a8cb" id="a8cb" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 429px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.3%;"></div><img class="graf-image" data-image-id="1*mn-jvw4IY6s_fdxF7KAPAA.png" data-width="3546" data-height="2174" src="https://cdn-images-1.medium.com/max/800/1*mn-jvw4IY6s_fdxF7KAPAA.png"></div></figure><h3 name="f463" id="f463" class="graf graf--h3 graf-after--figure">PyObjC</h3><ul class="postList"><li name="2f96" id="2f96" class="graf graf--li graf-after--h3">Since Mac OS X 10.5 Leopard</li><li name="8a2f" id="8a2f" class="graf graf--li graf-after--li">Python and ObjC bridge</li><li name="75c1" id="75c1" class="graf graf--li graf-after--li">Colon → underscore</li></ul><figure name="423d" id="423d" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 172px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 24.6%;"></div><img class="graf-image" data-image-id="1*WAyhfdV6o2Izr5GCLhLIUQ.png" data-width="3826" data-height="941" src="https://cdn-images-1.medium.com/max/800/1*WAyhfdV6o2Izr5GCLhLIUQ.png"></div></figure><h3 name="aa20" id="aa20" class="graf graf--h3 graf-after--figure">Python Bindings</h3><figure name="e0b1" id="e0b1" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 420px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 60%;"></div><img class="graf-image" data-image-id="1*XVghp4XQyDeznHmTNPFiYA.png" data-width="3132" data-height="1880" src="https://cdn-images-1.medium.com/max/800/1*XVghp4XQyDeznHmTNPFiYA.png"></div></figure><h3 name="b7ca" id="b7ca" class="graf graf--h3 graf-after--figure">PyCoreImage</h3><figure name="79ef" id="79ef" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 347px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 49.6%;"></div><img class="graf-image" data-image-id="1*KgudIZWt8SL52OL4cREn3Q.png" data-width="4428" data-height="2196" src="https://cdn-images-1.medium.com/max/800/1*KgudIZWt8SL52OL4cREn3Q.png"></div></figure><h3 name="b19a" id="b19a" class="graf graf--h3 graf-after--figure">Core Image for Python</h3><figure name="414f" id="414f" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 325px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 46.400000000000006%;"></div><img class="graf-image" data-image-id="1*RiCtW6JmXlQSE80Akz3FDA.png" data-width="4332" data-height="2012" src="https://cdn-images-1.medium.com/max/800/1*RiCtW6JmXlQSE80Akz3FDA.png"></div></figure><h3 name="7b39" id="7b39" class="graf graf--h3 graf-after--figure">Cheat Sheet</h3><figure name="8310" id="8310" class="graf graf--figure graf-after--h3"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 603px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 86.2%;"></div><img class="graf-image" data-image-id="1*AKoV5zSpTP6KAGGGrs57jw.png" data-width="4325" data-height="3727" src="https://cdn-images-1.medium.com/max/800/1*AKoV5zSpTP6KAGGGrs57jw.png"></div></figure><figure name="37b4" id="37b4" class="graf graf--figure graf-after--figure"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 392px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 56.00000000000001%;"></div><img class="graf-image" data-image-id="1*juYOEzzoZsefZ4mq2F7FNA.png" data-width="4402" data-height="2466" src="https://cdn-images-1.medium.com/max/800/1*juYOEzzoZsefZ4mq2F7FNA.png"></div></figure><h3 name="beb0" id="beb0" class="graf graf--h3 graf-after--figure">Demo1</h3><ul class="postList"><li name="16b1" id="16b1" class="graf graf--li graf-after--h3"><a href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/capturing_photos_with_depth" data-href="https://developer.apple.com/documentation/avfoundation/cameras_and_media_capture/capturing_photos_with_depth" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Sample Link</a></li></ul><figure name="dd3e" id="dd3e" class="graf graf--figure graf-after--li"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 6065px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 866.4%;"></div><img class="graf-image" data-image-id="1*0NhHFxAHiH3lSoqo7vD2wQ.jpeg" data-width="1280" data-height="11090" src="https://cdn-images-1.medium.com/max/800/1*0NhHFxAHiH3lSoqo7vD2wQ.jpeg"></div></figure><h3 name="3d89" id="3d89" class="graf graf--h3 graf-after--figure">Demo 2</h3><figure name="6bdc" id="6bdc" class="graf graf--figure graf-after--h3 graf--trailing"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 4476px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 639.5%;"></div><img class="graf-image" data-image-id="1*dVs3AFqTkbGWp8kXkUhd1Q.jpeg" data-width="1280" data-height="8185" src="https://cdn-images-1.medium.com/max/800/1*dVs3AFqTkbGWp8kXkUhd1Q.jpeg"></div></figure></div></div></section>
</section>